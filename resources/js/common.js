// Place use strict in the first file so that aggregation inherits it
"use strict";var App={initialize:function(){var e=$('a[rel="javascript"]');e.length&&e.removeAttr("onclick").removeAttr("onmouseover").removeAttr("title").css("cursor","pointer");var t=$("#support-link"),n=$("#explore-link"),r=$("#breaking-link"),i=$("#auth-link");t.length>0&&t.unbind().click(function(){return Tickets.loadStatus(),Toggle.open(this,"active","#support-menu"),!1}),i.length>0&&(i.unbind().click(function(){return Toggle.open(this,"active","#auth-menu"),!1}),$("#auth-menu a").click(function(){var e;this.className==="auth-close"?(Toggle.open(i,"active","#auth-menu"),i.parent().hide(),e="Close"):this.className==="auth-button"?e="Add":e="More",Cookie.create("serviceBar.authCheck",1,{expires:744,path:"/"})})),n.length>0&&n.unbind().click(function(){return Toggle.open(this,"active","#explore-menu"),!1}),r.length>0&&r.unbind().click(function(){return App.breakingNews(),!1})},closeWarning:function(e,t){$(e).hide(),t&&App.saveCookie(t)},breakingNews:function(e){var t=$("#breaking-news"),n=$("#announcement-warning");n.is(":visible")?(n.hide(),t.removeClass("opened")):(n.show(),t.addClass("opened")),e&&Cookie.create("serviceBar.breakingNews",e)},saveCookie:function(e){Cookie.create("serviceBar."+e,1,{expires:8760,path:"/"})},resetCookie:function(e){Cookie.create("serviceBar."+e,0,{expires:8760,path:"/"})},serviceBar:function(){var e=Cookie.read("serviceBar.browserWarning"),t=Cookie.read("serviceBar.localeWarning");e===1&&$("#browser-warning").hide(),t===1&&$("#i18n-warning").hide()},totalModules:0,totalLoaded:0,modules:[],forceLoad:!0,sidebar:function(e){App.totalModules=e.length;if(e.length)for(var t=0;t<=e.length-1;++t)App.loadModule(e[t],t);window.setTimeout(function(){App.forceLoad&&App.showSidebar()},5e3)},showSidebar:function(){App.forceLoad=!1;var e=$("#dynamic-sidebar-target"),t=$("#sidebar .sidebar-bot");for(var n=0;n<App.totalModules;n++)App.modules[n]&&App.modules[n].appendTo(e);$("#sidebar-loading").fadeOut("normal",function(){t.find(".sidebar-module").fadeIn(),$(this).remove()}),App.modules=[],App.totalModules=0,App.totalLoaded=0},loadModule:function(e,t){var n=$("#dynamic-sidebar-target");$.ajax({url:Core.baseUrl+"/sidebar/"+e.type+(e.query||""),type:"GET",dataType:"html",cache:!0,global:!1,success:function(e){App.totalLoaded++;if($.trim(e)!==""){var r=$(e);App.forceLoad?(r.hide(),App.modules[t]=r):r.appendTo(n)}},error:function(){App.totalLoaded++},complete:function(){App.totalLoaded>=App.totalModules&&window.setTimeout(App.showSidebar,100)}})}};$(function(){App.initialize()});var Blackout={initialized:!1,element:null,shim:null,initialize:function(){Blackout.element=$("<div/>",{id:"blackout"}),Blackout.element.on("click",Core.stopPropagation).on("keyup",Blackout.listen),$("body").append(Blackout.element),Core.browser.full==="ie6"&&(Blackout.element.css("backgroundColor","#000"),Blackout.element.css("filter","alpha(opacity=70)"),Blackout.shim=$("<iframe />",{src:"javascript:false;",frameborder:0,scrolling:"no"}).addClass("support-shim"),Blackout.element.append(Blackout.shim)),Blackout.initialized=!0},listen:function(e){e.which===KeyCode.esc&&Blackout.hide()},show:function(e,t,n){Blackout.initialized||Blackout.initialize(),Core.isIE()&&(Blackout.element.css("width",Page.dimensions.width).css("height",$(document).height()),Core.browser.full==="ie6"&&(Blackout.shim.css("width",Blackout.element.css("width")).css("height",Blackout.element.css("height")),Core.isCallback(t)&&(Blackout.shim[0].contentWindow.document.onclick=t))),n&&Blackout.element.addClass("blackout-transparent"),Blackout.element.show(),Core.isCallback(e)&&e(),Core.isCallback(t)&&Blackout.element.click(t)},hide:function(e){Blackout.element.hide(),Core.isCallback(e)&&e(),Blackout.element.unbind("click").removeClass("blackout-transparent")}},CharSelect={textareaContent:"",beforeCallback:null,afterCallback:null,initialize:function(){$(document).on("click","a.context-link",CharSelect.toggle),$("input.character-filter").on({blur:function(){Toggle.keepOpen=!1},keydown:function(e){e.which===KeyCode.enter&&(e.stopPropagation(),e.preventDefault())},keyup:CharSelect.filter}),Input.bind(".character-filter")},pin:function(e,t){Tooltip.hide(),$("div.character-list").html("").addClass("loading-chars"),$.ajax({type:"POST",url:Core.baseUrl+"/pref/character",data:{index:e,xstoken:Cookie.read("xstoken")},global:!1,success:function(e){Core.isIE()&&location.reload(!0);if(Core.isCallback(CharSelect.beforeCallback)&&CharSelect.beforeCallback(t))return;CharSelect.updateComments(e),CharSelect.update()}})},update:function(){$.ajax({url:location.href,cache:!1,global:!1,error:function(){location.reload(!0)},success:function(e){var t=$(typeof e=="string"?e:e.documentElement);$(".ajax-update").each(function(){var e=$(this),n;e.attr("id")?n="#"+e.attr("id"):(n=e.attr("class").replace("ajax-update","").trim(),n="."+n.split(" ")[0]);var r=t.find(n+".ajax-update").clone(),i=e.find("textarea");i.length&&i.val().length&&(CharSelect.textareaContent=i.val()),r.length&&e.replaceWith(r)}),Core.isCallback(CharSelect.afterCallback)&&CharSelect.afterCallback()}})},updateComments:function(e){var t=$(typeof e=="string"?e:e.documentElement),n=$("#comments");if(n.length){var r=$(".comments-form",$("#comments"));$(".character-info",r).each(function(){var e=t.find(".character-info").clone();$(this).replaceWith(e)}),$(".avatar-outer a",r).each(function(){var e=t.find(".portrait-b .avatar-interior a").clone();$(this).replaceWith(e)}),typeof Comments!="undefined"&&($(".character-info",Comments.replyForm).each(function(){$(this).replaceWith(t.find(".character-info").clone())}),$(".avatar-outer a",Comments.replyForm).each(function(){$(this).replaceWith(t.find(".portrait-b .avatar-interior a").clone())}))}},toggle:function(e){return e.stop(),Toggle.open(e.currentTarget,"context-open",$(e.currentTarget).siblings(".ui-context")),!1},close:function(e){return $(e).parents(".ui-context").hide().siblings(".context-link").removeClass("context-open"),!1},swipe:function(e,t){var n=$(t).parents(".chars-pane"),r=e=="in"?"left":"right",i=e=="in"?"right":"left";n.hide("slide",{direction:r},150,function(){n.siblings(".chars-pane").show("slide",{direction:i},150,function(){var e=$(this).find(".scrollbar-wrapper");e.length>0&&e.tinyscrollbar()})})},filter:function(e){e.stop(),Toggle.keepOpen=!0;if(e.keyCode==KeyCode.enter)return;var t=$(e.srcElement||e.currentTarget),n=t.val().toLowerCase(),r=t.parents(".chars-pane").find(".overview");e.keyCode==KeyCode.esc&&t.val("");if(t.val().length<1)r.children("a").removeClass("filtered");else{r.children("a").each(function(){$(this)[$(this).text().toLowerCase().indexOf(n)>-1?"removeClass":"addClass"]("filtered")});var i=r.children("a.filtered").length>=r.children("a").length;r.children(".no-results")[i?"show":"hide"]()}var s=t.parents(".chars-pane:first").find(".scrollbar-wrapper");s.length>0&&s.tinyscrollbar()}};$(function(){CharSelect.initialize()});var Cookie={cache:{},create:function(e,t,n){n=$.extend({},n),n.expires=n.expires||1;if(typeof n.expires=="number"){var r=n.expires;n.expires=new Date,n.expires.setTime(n.expires.getTime()+r*36e5)}var i=[encodeURIComponent(e)+"=",n.escape?encodeURIComponent(t):t,n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""];document.cookie=i.join(""),Cookie.cache&&(n.expires.getTime()<(new Date).getTime()?delete Cookie.cache[e]:Cookie.cache[e]=t)},read:function(e){if(Cookie.cache[e])return Cookie.cache[e];var t={},n=document.cookie.split(";");if(n.length>0)for(var r=0;r<n.length;r++){var i=n[r].split("=");i.length>=2&&(t[$.trim(i[0])]=i[1])}return Cookie.cache=t,t[e]||null},erase:function(e,t){t?t.expires||(t.expires=-1):t={expires:-1},Cookie.create(e,0,t)},isSupported:function(){return document.cookie.indexOf("=")!==-1}},Core={baseUrl:"/",supportUrl:"/support/",browser:null,deferredLoadQueue:[],locale:"en-us",region:"us",shortDateFormat:"MM/dd/Y",dateTimeFormat:"dd/MM/yyyy HH:mm",project:"",staticUrl:"/",sharedStaticUrl:"/local-common/",host:"",initialize:function(){Core.processLoadQueue(),Core.ui(),Core.host=location.protocol+"//"+(location.host||location.hostname);var e=$("html"),t=Core.getBrowser();e.addClass(t.name).addClass(t.full),t.name==="ie"&&(t.version===6||t.version===7)&&e.addClass("ie67")},alpha:function(e){return e.replace(/[^a-zA-Z]/gi,"")},appendFrame:function(e,t,n,r,i){if(typeof e=="undefined")return;typeof t=="undefined"&&(t=1),typeof n=="undefined"&&(n=1),typeof r=="undefined"&&(r=$("body")),Core.isIE()?r.append('<iframe src="'+e+'" width="'+t+'" height="'+n+'" scrolling="no" frameborder="0" allowTransparency="true"'+(typeof i!="undefined"?' id="'+i+'"':"")+"></iframe>"):r.append('<object type="text/html" data="'+e+'" width="'+t+'" height="'+n+'"'+(typeof i!="undefined"?' id="'+i+'"':"")+"></object>")},fixTableHeaders:function(e,t){$(e).each(function(){t=t||18;var e=$(this),n=t;e.find(".sort-link").each(function(){var e=$(this).height();e>n&&(n=e)}),n>t&&e.find(".sort-link, .sort-tab").css("height",n)})},formatLocale:function(e,t){t=t||"-",e=e||1;switch(e){case 1:default:return Core.locale.replace("-",t);case 2:var n=Core.locale.split("-");return n[0]+t+n[1].toUpperCase();case 3:return Core.locale.toUpperCase().replace("-",t)}},formatDatetime:function(e,t){var n;if(!t)n=new Date;else{n=new Date(t),isNaN(n.getTime())&&(t=t.substring(0,10)+" "+t.substring(11,16)+":00 GMT"+t.substring(16,19)+t.substring(20,22),n=new Date(t)),isNaN(n.getTime())&&(t=t.substring(0,4)+"/"+t.substring(5,7)+"/"+t.substring(8,29),n=new Date(t)),isNaN(n.getTime())&&(t=t.substring(5,10)+" "+t.substring(11,16)+" GMT"+t.substring(23,28)+" "+t.substring(0,4),n=new Date(t));if(isNaN(n.getTime()))return!1}e||(e="yyyy-MM-ddThh:mmZ");var r=n.getHours(),i="AM";r>12?(r-=12,i="PM"):r===12?i="PM":r===0&&(r=12);var s=parseInt(n.getTimezoneOffset()/60*-1,10);return s<0?s="-"+Core.zeroFill(Math.abs(s),2)+":00":s=" + "+Core.zeroFill(Math.abs(s),2)+":00",e=e.replace("yyyy",n.getFullYear()),e=e.replace("MM",Core.zeroFill(n.getMonth()+1,2)),e=e.replace("dd",Core.zeroFill(n.getDate(),2)),e=e.replace("HH",Core.zeroFill(n.getHours(),2)),e=e.replace("hh",Core.zeroFill(r,2)),e=e.replace("mm",Core.zeroFill(n.getMinutes(),2)),e=e.replace("a",i),e=e.replace("Z",s),e},getBrowser:function(){if(Core.browser)return Core.browser;var e=$.support,t="",n=0;return!e.hrefNormalized&&!e.tbody&&!e.style&&!e.opacity?typeof document.body.style.maxHeight!="undefined"||window.XMLHttpRequest?(t="ie",n=7):(t="ie",n=6):e.hrefNormalized&&e.tbody&&e.style&&!e.opacity?(t="ie",n=8):typeof $.browser!="undefined"&&($.browser.mozilla?t="ff":$.browser.msie?t="ie":$.browser.webkit?navigator.userAgent.toLowerCase().indexOf("chrome")>=0?t="chrome":t="safari":$.browser.opera&&(t="opera"),n=parseInt($.browser.version)),Core.browser={name:t,full:t+n,version:n},Core.browser},getHash:function(){var e=location.hash||"";return e.substr(1,e.length)},getLanguage:function(){return Core.locale.split("-")[0]},getRegion:function(){return Core.locale.split("-")[1]},goTo:function(e,t){window.location.href=(t?Core.baseUrl:"")+e,window.event&&(window.event.returnValue=!1)},include:function(e,t,n){$.ajax({url:e,dataType:"script",success:t,cache:n!==!1})},isCallback:function(e){return e&&typeof e=="function"},isIE:function(e){var t=Core.getBrowser();return e?e===t.version:t.name==="ie"},load:function(e,t,n){t=t!==!1,Page.loaded||!t?Core.loadDeferred(e,n):Core.deferredLoadQueue.push(e)},loadDeferred:function(e,t){var n=e.indexOf("?"),r=e.lastIndexOf(".")+1,i=e.substring(r,n===-1?e.length:n);switch(i){case"js":Core.loadDeferredScript(e,t);break;case"css":Core.loadDeferredStyle(e)}},loadDeferredScript:function(e,t){$.ajax({url:e,cache:!0,global:!1,dataType:"script",success:t})},loadDeferredStyle:function(e,t){$("head").append('<link rel="stylesheet" href="'+e+'" type="text/css" media="'+(t||"all")+'" />')},msg:function(e){for(var t=1,n=arguments.length;t<n;++t)e=e.replace("{"+(t-1)+"}",arguments[t]);return e},msgAll:function(e){for(var t=1,n=arguments.length;t<n;++t)e=e.replace(new RegExp("\\{"+(t-1)+"\\}","g"),arguments[t]);return e},numeric:function(e){e=e.replace(/[^0-9]/gi,"");if(!e||isNaN(e))e=0;return e},open:function(e){return e.href&&window.open(e.href),!1},preventDefault:function(e){e.preventDefault()},processLoadQueue:function(){if(Core.deferredLoadQueue.length>0)for(var e=0,t;t=Core.deferredLoadQueue[e];e++)Core.load(t)},randomNumber:function(e){return Math.floor(Math.random()*e)},scrollTo:function(e,t,n){e=$(e);if(e.length!==1)return;var r=$(window),i=r.scrollTop(),s=i+r.height(),o=e.offset().top;o-=15;if(o>=i&&o<=s)return;$($.browser.webkit?"body":"html").animate({scrollTop:o},t||350,n||null)},scrollToVisible:function(e,t,n){e=$(e);if(e.length!==1)return;var r=$(window),i=r.scrollTop(),s=i+r.height(),o=e.offset().top,u=o+e.height();o-=15,u+=15;if(o>=i&&u<=s)return;$($.browser.webkit?"body":"html").animate({scrollTop:o<i?o:u-r.height()},t||350,n||null)},stopEvent:function(e){e.stop()},stopPropagation:function(e){e.stopPropagation()},trimChar:function(e,t){return e.substr(0,1)===t&&(e=e.substr(1,e.length-1)),e.substr(e.length-1,e.length)===t&&(e=e.substr(0,e.length-1)),e},trimRight:function(e,t){return t=t?(t+"").replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,"\\$1"):" \\s ",(e+"").replace(new RegExp("["+t+"]+$","g"),"")},ui:function(e){e=e||document,Core.isIE(6)&&$(e).find("button.ui-button").hover(function(){(!this.disabled||this.className.indexOf("disabled")==-1)&&$(this).addClass("hover")},function(){$(this).removeClass("hover")}),Core.project!=="bam"&&$(e).find("button.ui-button").click(function(e){var t=$(this),n=t.attr("data-text");return typeof n=="undefined"&&(n=""),this.tagName.toLowerCase()==="button"&&n!==""&&t.attr("type")==="submit"&&(e.preventDefault(),e.stopPropagation(),t.find("span span").html(n),t.removeClass("hover").addClass("processing").attr("disabled","disabled"),t.parents("form").submit()),!0})},zeroFill:function(e,t,n){typeof n=="undefined"&&(n=!1);var r=parseFloat(e),i=!1,s=t-r.toString().length,o=s-1;r<0&&(r=Math.abs(r),i=!0,s++,o=s-1);if(t>0){r.toString().indexOf(".")>0&&(n||(s+=r.toString().split(".")[1].length),s++,o=s-1);if(o>=0)do r="0"+r;while(o--)}return i?"-"+r:r},trackEvent:function(e,t,n){window._gaq=_gaq||[],_gaq.push(["_trackEvent",e,t,n])},bindTrackEvent:function(e,t,n,r){$(e).on("click.analytics",function(){var e=$(this);t=e.data("category")||t||Core.project,n=e.data("action")||n||"Click",r=e.data("label")||r||Core.locale,Core.trackEvent(t,n,r)})},showUntilClosed:function(e,t,n){n=n||{};var r=$(e),i="bnet.closed."+t;if(!r.length||!Cookie.isSupported()||Cookie.read(i))return!1;var s=new Date;if(n.startDate){var o=new Date(n.startDate);if(o-s>0)return!1}if(n.endDate){var u=new Date(n.endDate);if(u-s<0)return!1}n.fadeIn?r.fadeIn(n.fadeIn,n.onShow):(r.show(),n.onShow&&n.onShow());var a=$.extend({path:Core.baseUrl,expires:8760},n.cookieParams||{});return r.delegate("a","click",function(){var e=$(this),t=e.data("label"),s=this.rel==="close";s&&(r.hide(),n.onHide&&n.onHide()),(s||!n.closeButtonOnly)&&Cookie.create(i,1,a),t&&Marketing.trackImpression(n.trackingCategory||"Tracking",n.trackingAction||"Click",t)}),!0}};$(function(){Core.initialize()});var Feedback={form:null,ID_MAP:{url:"feedback-page-url",email:"feedback-email",subject:"feedback-subject",body:"feedback-body"},overlayInstance:null,pageErrorMsg:"",pageReferring:"",feedbackUrl:"",initialize:function(){if($("#feedback-page").length)return;this.feedbackUrl="/"+Core.locale+"/feedback/";var e=$(".feedback-suggestion-open"),t=$(".feedback-error-open"),n=this;e.each(function(){this.onclick=function(){return n.open("suggestion"),!1}}),t.each(function(){this.onclick=function(){return n.open("bug"),!1}}),this.overlayInstance=Overlay},open:function(e){var t=this;t.overlayInstance.open(t.feedbackUrl+"feedback-form.frag",{ajax:!0,className:"feedback-overlay",bindClose:!1}),$("#overlay").unbind("overlayLoaded"),$("#overlay").bind("overlayLoaded",function(){var n=$(t.overlayInstance.wrapper);t.overlayInstance.position(),n.css("position","absolute"),parseInt(n.css("top"),10)<0&&n.css("top",0),t.form=document.getElementById("website-feedback");var r=$(".feedback-wrapper h2"),i=$("#feedback-intro-message"),s=document.getElementById("feedback-submit"),o=document.getElementById("feedback-subject"),u=document.getElementById("feedback-page-url"),a=document.getElementById("page-url-system"),f=$(".feedback-body-label #body-label-text"),l=document.getElementById("feedback-body"),c=document.getElementById("feedback-body-char-count"),h=$(c),p=l.getAttribute("maxlength");$(".overlay-close").unbind("click").bind("click",function(e){e.preventDefault(),t.cancel()}),e==="suggestion"?(r.html(Feedback.titleWebsiteSuggestion),i.html(Feedback.introFeedback)):(r.html(Feedback.titleWebsiteFeedback),i.html(Feedback.introError),f.html(Feedback.feedbackError)),t.form.setAttribute("action",t.feedbackUrl+e),o.value=t.pageErrorMsg,u.value=t.pageReferring,a.value=t.pageReferring,$(u).focus(),$("#blackout").bind("click.feedback",function(e){$(u).focus()}),$(u).keydown(function(e){e.which===9&&e.shiftKey&&(e.preventDefault(),$(cancelBtn).focus())}),s.onclick=function(){if(!t.submit())return!1},c.parentNode.style.display="block",c.firstChild.nodeValue=p,l.onkeyup=function(){this.value.length>p?($(this).addClass(".feedback-error"),h.addClass("error")):h.removeClass("error"),h.html(p-this.value.length)}})},submit:function(){var e=this.form.getAttribute("action"),t=document.getElementById("feedback-email"),n=document.getElementById("feedback-body-char-count"),r=document.getElementById("feedback-body"),i=$("#feedback-intro-message"),s=this;$(".feedback-error").each(function(){var e=$(this);e.removeClass("feedback-error"),e.attr("id")!=="feedback-body-char-count"&&e.next(".feedback-error-msg").hide(),$(n).removeClass("error")}),r.value.length>(r.hasAttribute("maxlength")?r.getAttribute("maxlength"):2e3)&&($(r).addClass("feedback-error"),$(n).addClass("error"));var o=$(".feedback-required",this.form);o.each(function(){var e=$(this);if(e.val()===null||$.trim(e.val())==="")e.addClass("feedback-error"),e.next(".feedback-error-msg").show()});if($(".feedback-error").length===0){var u=$(s.form).serializeArray();if($.trim(t.value)==="")for(var a=0,f=u.length;a<f;a+=1)u[a].name==="email"&&(u[a].value="no_email_given@blizzard.com");return $.ajax({type:"POST",url:e,data:u,success:function(){var e=document.getElementById("feedback-success"),t=document.getElementById("feedback-close");s.form.style.display="none",e.style.display="block",i.hide(),t.onclick=function(){s.cancel()}},error:function(e){var t;try{t=JSON.parse(e.responseText);if(t)return $.each(t.fieldErrors,function(e,t){$("#"+s.ID_MAP[e]).addClass("feedback-error").next(".feedback-error-msg").show()}),!1;throw"Invalid response"}catch(n){var r=document.getElementById("feedback-fail"),i=document.getElementById("feedback-fail-close");return s.form.style.display="none",r.style.display="block",i.onclick=function(){s.cancel()},!1}}}),!1}},cancel:function(){return $(".feedback-wrapper").remove(),$("#blackout").unbind("click.feedback"),this.overlayInstance.close(),this.overlayInstance.cache={},!1}},Filter={query:{},timers:{},initialize:function(e){var t=0;if(location.hash){var n=Core.getHash();if(n!=="reset"){var r=n.split("&"),i;for(var s=0,o=r.length;s<o;++s)i=r[s].split("="),Filter.query[i[0]]=decodeURIComponent(i[1])||"null",t++}}Filter.uiSetup(!0),Core.isCallback(e)&&e(Filter.query,t)},addParam:function(e,t){e&&(!t||t===""?Filter.deleteParam(e):Filter.query[e]=t)},appendRangeData:function(e,t){var n={};return typeof e.data("min")!="undefined"?n={min:parseInt(t,10),max:parseInt(e.siblings("input[data-max]").val(),10),base:e.data("min"),type:"min"}:n={min:parseInt(e.siblings("input[data-min]").val(),10),max:parseInt(t,10),base:e.data("max"),type:"max"},n},applyQuery:function(){var e=[];if(Filter.query)for(var t in Filter.query)Filter.query[t]!==null&&Filter.query.hasOwnProperty(t)&&e.push(t+"="+encodeURIComponent(Filter.query[t]));e.length>0?location.replace("#"+e.join("&")):Filter.reset()},bindInputs:function(e,t){$(e).find("[data-filter]").each(function(){var e=$(this),n=Filter.extractData(e);n.field==="text"||n.field==="textarea"?e.keyup(function(){n.value=e.val(),n.filter==="range"&&(n.range=Filter.appendRangeData(e,n.value)),Filter.setTimer(n.name,n,t)}):n.field==="a"?e.click(function(){n.value=e.data("value"),t(n)}):e.change(function(){var r=typeof e.data("value")!="undefined"?e.data("value"):"";n.field==="checkbox"?n.value=e.is(":checked")?r||"true":"":n.value=r||e.val(),t(n)})})},defaultApply:function(e,t){t>0&&$.each(e,function(e,t){var n=$("#filter-"+e);if(!n.length)return;n.is(":checkbox")&&t==="true"?n.prop("checked",!0):n.val(t)})},deleteParam:function(e){Filter.query[e]=null},extractData:function(e){var t=$(e),n=t.prop("nodeName").toLowerCase();return{tag:n,node:t,name:typeof t.data("name")!="undefined"?t.data("name"):t.attr("id").replace("filter-",""),filter:t.data("filter"),column:t.data("column"),field:n==="input"?t.attr("type"):n,value:""}},getParam:function(e){return Filter.query[e]||null},reset:function(){Filter.query={},Filter.timers={},location.replace("#reset")},resetInputs:function(e){if(!e)return;$(e).find("input, select, textarea").each(function(){var e=$(this),t;(t=e.data("min"))!=="undefined"?e.val(t):(t=e.data("max"))!=="undefined"?e.val(t):(t=e.data("default"))!=="undefined"?e.val(t):e.val(""),e.removeClass("active").removeAttr("checked"),this.tagName.toLowerCase()==="input"&&(this.type==="checkbox"||this.type==="radio")&&(this.checked=!1)})},setTimer:function(e,t,n){Filter.timers[e]!==null&&(window.clearTimeout(Filter.timers[e]),Filter.timers[e]=null),Filter.timers[e]=window.setTimeout(function(){n(t)},350)},applyReset:!1,uiClick:function(e){var t=$(e.currentTarget||e.target),n=t.siblings(".view"),r=t.siblings(".reset");t.val()!==""?(n.hide(),r.show()):(n.show(),r.hide())},uiReset:function(e){var t=$(e.currentTarget||e.target),n=t.siblings(".view"),r=t.siblings(".input");n.show(),t.hide(),r.trigger("reset");if(Filter.applyReset){var i=Filter.extractData(r);Filter.deleteParam(i.name),Filter.applyQuery()}},uiSetup:function(e){var t=$(".ui-filter");t.length&&(t.find(".reset").click(Filter.uiReset),t.find(".input").bind({keyup:Filter.uiClick,focus:Input.activate,blue:Input.reset,reset:function(){$(this).val("").trigger("keyup").trigger("blur")}})),Filter.applyReset=e}},Flash={videoPlayer:"",videoBase:"",ratingImage:"",expressInstall:"expressInstall.swf",requiredVersion:"10.2.154",initialize:function(){Flash.defaultVideoFlashVars.ratingPath=Flash.ratingImage,Flash.defaultVideoFlashVars.locale=Core.locale,Flash.defaultVideoFlashVars.dateFormat=Core.shortDateFormat},defaultVideoParams:{allowFullScreen:"true",bgcolor:"#000000",allowScriptAccess:"always",wmode:"opaque",menu:"false"},defaultVideoFlashVars:{ratingFadeTime:"1",ratingShowTime:"4",autoPlay:!0},getFlashError:function(){var e=$('<div id="flash-error" class="align-center" />');return e.append('<h3 class="subheader">'+Msg.ui.flashErrorHeader+"</h3>"+'<p><a href="'+Msg.ui.flashErrorUrl+'">'+Msg.ui.flashErrorText+"</a></p>"),e}};$(function(){Flash.initialize()});var Hash={base:"aZbYcXdWeVfUgThSiRjQkPlOmNnMoLpKqJrIsHtGuFvEwDxCyBzA0123456789+/",delimiter:"!",empty:".",batch:function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(Hash.encode(e[n]));return Core.trimRight(t.join(Hash.delimiter),Hash.delimiter)},encode:function(e,t){var n="",r=Hash.base,i=Hash.empty;for(var s=0,o=e.length;s<o;s++)e[s]!==null?n+=r.charAt(e[s]):t&&(n+=i);return Core.trimRight(n,i)},decode:function(e){var t=[],n=Hash.base,r=Hash.empty;for(var i=0,s=e.length,o;i<s;i++)o=e.charAt(i),o=o===r?null:n.indexOf(o),t.push(o);return t}},History={enabled:window.history.pushState,hashbangs:{},log:[],hashChangeCallback:null,popStateCallback:null,initialize:function(){window.onhashchange=History.onHashChange,window.onpopstate=History.onPopState},lookup:function(e){return History.log[e]||History.log},flush:function(){History.log=[]},isHashbang:function(){return Core.getHash().charAt(0)==="!"},push:function(e,t){e=History.packageState(e),History.log.push([e,t]),History.enabled?window.history.pushState(e,document.title,t):History.updateHash(e,t)},replace:function(e,t){e=History.packageState(e,!0),History.log[History.log.length-1]=[e,t],History.enabled?window.history.replaceState(e,document.title,t):History.updateHash(e,t)},updateHash:function(e,t){t.indexOf("#")!==-1&&(t=t.split("#")[0]),t.charAt(0)!=="/"&&(t="/"+t),t="!"+t.replace("?",""),location.hash=t,History.hashbangs[t]=e},packageState:function(e,t){return t?e.logIndex=History.log.length:e.logIndex=History.log.length+1,e.replacedState=t===!0,e.pageTitle=document.title,e.currentHash=location.hash,e.absoluteUrl=location.href,e.isHashbang=!History.enabled,e},onHashChange:function(e){if(Core.isCallback(History.hashChangeCallback)){var t=History.hashbangs[Core.getHash()]||null;History.hashChangeCallback(e,t)}},onPopState:function(e){Core.isCallback(History.popStateCallback)&&History.popStateCallback(e)}};$(function(){History.initialize()});var Input={initialize:function(){Input.bind("#search-field")},bind:function(e){Input.reset(e);var t=$(e);t.focus(Input.activate).blur(Input.reset),t.closest("form").submit(function(){return Input.submit(t)})},activate:function(e){var t=typeof e=="string"?$(e):$(this);if(!t.length)return;t.val()===t.attr("alt")&&t.val(""),t.addClass("active")},reset:function(e){var t=typeof e=="string"?$(e):$(this);if(!t.length)return;t.val()===""?t.removeClass("active").val(t.attr("alt")):t.val()!==t.attr("alt")&&t.addClass("active")},submit:function(e){return e=$(e||this),e.val()===e.attr("alt")&&e.val(""),!0}};$(function(){Input.initialize()});var KeyCode={backspace:8,enter:13,esc:27,space:32,tab:9,arrowLeft:37,arrowUp:38,arrowRight:39,arrowDown:40,map:{global:{numbers:[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105],letters:[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90],controls:[8,9,13,16,17,18,20,27,33,32,34,35,36,45,46,144],functions:[112,113,114,115,116,117,118,119,120,121,122,123],arrows:[37,38,39,40],os:[17,91,92,93,219,224]},de:{letters:[59,192,219,222]},es:{letters:[59,192]},ru:{letters:[59,188,190,192,219,221,222]},fr:{letters:[191]}},arrows:function(e){return KeyCode.get("arrows",e)},controls:function(e){return KeyCode.get("controls",e)},functions:function(e){return KeyCode.get("functions",e)},get:function(e,t){t=t||Core.getLanguage();var n=[],r=[];typeof e=="string"?r=[e]:r=e;for(var i=0,s=r.length;i<s;++i){var o=r[i];if(!KeyCode.map.global[o])continue;n=n.concat(KeyCode.map.global[o]),KeyCode.map[t]&&KeyCode.map[t][o]&&(n=n.concat(KeyCode.map[t][o]))}return n},isAlpha:function(e,t){return $.inArray(e.which,KeyCode.get(["letters","controls"],t))>=0},isAlnum:function(e,t){return KeyCode.isAlpha(e,t)||KeyCode.isNumeric(e,t)},isNumeric:function(e,t){return $.inArray(e.which,KeyCode.get(["numbers","controls"],t))>=0&&!e.shiftKey},letters:function(e){return KeyCode.get("letters",e)},numbers:function(e){return KeyCode.get("numbers",e)}},LazyLoad={delay:7500,threshold:150,loaded:!1,initialize:function(){var e='<style type="text/css">.lazy-load { background: none !important; }.lazy-load * { display: none !important; }</style>';$("head").append(e),$(window).bind("scroll.lazyload resize.lazyload",LazyLoad.reveal),$(function(){LazyLoad.reveal(),LazyLoad.delay>0&&window.setTimeout(LazyLoad.loadAll,LazyLoad.delay)})},reveal:function(){if(LazyLoad.loaded)return!1;var e=$(".lazy-load");if(e.length===0)return LazyLoad.loadAll(),!1;e.each(function(){var e=$(this);LazyLoad.inViewport(e)&&e.removeClass("lazy-load")})},loadAll:function(){LazyLoad.loaded=!0,$(".lazy-load").removeClass("lazy-load"),$(window).unbind("scroll.lazyload resize.lazyload")},inViewport:function(e){var t=$(window),n=LazyLoad.threshold,r=t.height(),i=t.width(),s=t.scrollTop(),o=t.scrollLeft(),u=e.offset();return u.top>=s-n&&u.top<=s+r+n&&u.left>=o-n&&u.left<=o+i+n}};LazyLoad.initialize();var Locale={dataPath:"data/i18n.frag",initialize:function(){var e=location.pathname.replace(Core.baseUrl,"");e+=location.search||"?",$("#change-language, #service .service-language a").click(function(){return Locale.openMenu("#change-language",encodeURIComponent(e))})},openMenu:function(e,t){var n=$("#international");return e=$(e),t=t||"",n.is(":visible")?(n.slideUp(),e.toggleClass("open")):n.html()!==""?(Locale.display(),e.toggleClass("open")):$.ajax({url:Core.baseUrl+"/"+Locale.dataPath+"?path="+t,dataType:"html",success:function(t){t&&(n.replaceWith(t),e.toggleClass("open"),Locale.display())}}),!1},trackEvent:function(e,t){try{_gaq.push(["_trackEvent","Battle.net Language Change Event",e,t])}catch(n){}},display:function(){var e=$("#international");e.slideDown("fast",function(){$(this).css("display","block")}),$.browser.opera||$("html, body").animate({scrollTop:e.offset().top},1e3)}};$(function(){Locale.initialize()});var Login={CONTAINER_ID:"login-embedded",FADE_DURATION:"slow",embeddedUrl:"/login.php",success:function(e){$("<div/>",{id:"embedded-loader"}).appendTo("body"),window.setTimeout(function(){var t=window.location.search?"&":"?";if(window.location.hash.length===0)window.location=window.location+t+"ST="+e;else{var n=window.location.href.substring(0,window.location.href.length-window.location.hash.length);window.location=n+t+"ST="+e+"&ST-frag="+window.location.hash.substring(1)}},100)},open:function(e,t,n){e=e||Login.embeddedUrl,Login._timeTracker.start(),"https:"===document.location.protocol&&(e+=e.indexOf("?")===-1?"?":"&",e+="secureOrigin=true");if(document.getElementById(Login.CONTAINER_ID))return!1;if(typeof postMessage!="object"&&typeof postMessage!="function"||typeof JSON!="object"){if(t){var r=n.indexOf("?")===-1?"?":"&";return document.location=t+encodeURIComponent(n+r+"ST-frag="+encodeURIComponent(Core.getHash())),!1}return!0}var i=$("<div/>",{id:Login.CONTAINER_ID});return i.append($("<iframe/>",{src:e,frameborder:0})),Core.isIE()&&$(window).resize(function(){var e=$(document);$("#blackout").css({width:e.width(),height:e.height()})}),i.appendTo("body").show(),Blackout.show(null,function(){Blackout.hide(),Login._close()}),Login._setListener(),!1},openOrRedirect:function(e,t,n){if(Login.open(e,t,n)){var r=location.href,i=r.indexOf("?")===-1?"?":"&";location.href=r+i+"login=true&cr=true"}},_close:function(e){Login._removeListener(),e=e||!1,$("#"+Login.CONTAINER_ID).fadeOut(Login.FADE_DURATION,function(){ifnotloginiframecanchangethisvalue?window.location.href=siteaddressforalljsfile:($(this).remove(),e&&Blackout.hide())})},_messageListener:function(e){var t=JSON.parse(e.data);switch(t.action){case"onload":Login._timeTracker.end();var n=$("#"+Login.CONTAINER_ID),r=$("#"+Login.CONTAINER_ID+" iframe");n.css("height",t.height),r.css("height",t.height),t.height>500&&(n.css("margin-top",-(t.height/2)),n.css("margin-bottom",-(t.height/2)));break;case"success":Login._close(),Login.success(t.loginTicket);break;case"close":Login._close(!0);break;case"redirect":window.location=t.url+"?ref="+encodeURIComponent(window.location)}},_setListener:function(){Login._removeListener(),Login._listener=function(e){Login._messageListener(e)},typeof addEventListener!="undefined"?addEventListener("message",Login._listener,!1):attachEvent("onmessage",Login._listener)},_removeListener:function(){if(!Login._listener)return;typeof removeEventListener!="undefined"?removeEventListener("message",Login._listener,!1):detachEvent("onmessage",Login._listener)},_timeTracker:{startTime:null,start:function(){this.startTime=(new Date).getTime()},end:function(){_gaq.push(["_trackEvent","debug","login frag load time",Math.round(((new Date).getTime()-this.startTime)/500)*500])}}},Marketing={bindTracking:function(e,t,n){$(e).click(function(){var e=$(this);try{_gaq.push(["_trackEvent",e.data("category")||t,e.data("action")||n,e.data("ad")+" ["+Core.locale+"]"])}catch(r){}})},trackActivity:function(e,t){try{_gaq.push(["_trackEvent","Battle.net User Activity",e,t+" ["+Core.locale+"]"])}catch(n){}},trackAd:function(e,t,n,r){try{n=n?n+" - ":"",_gaq.push(["_trackEvent","Battle.net Ad Service",r?"Ad Click-Throughs":"Ad Impressions","Ad "+encodeURIComponent(t.replace(" ","_"))+" - "+n+Core.locale+" - "+e])}catch(i){}},trackImpression:function(e,t,n){try{_gaq.push(["_trackEvent",e,t,n+" ["+Core.locale+"]"])}catch(r){}}},Menu={data:{},dataIndex:{},container:null,node:null,idName:"menu-tier",className:"flyout-menu",timer:null,timers:{},openTimer:null,children:{},config:{},initialize:function(e,t){Menu.config=$.extend({},{duration:750,dataUrl:{},colWidth:200,colMax:15},t),Menu.container=$("<div/>").attr("id","menu-container").appendTo("body"),Menu.container.unbind().mouseleave(function(){Menu.timer=window.setTimeout(function(){Menu.hide()},Menu.config.duration)}).mouseenter(function(){window.clearTimeout(Menu.timer)});if(!e)return!1;Menu.load("base",e),$(".ui-breadcrumb li a").each(function(e,t){var n=$(t),r=n.attr("href").replace(Core.baseUrl,"");n.mouseover(function(){Menu.show(this,r)})})},hide:function(){window.clearTimeout(Menu.timer),window.clearTimeout(Menu.openTimer),Menu.container.find("div").hide(),Menu.node&&(Menu.node.removeClass("opened"),Menu.node=null)},hideChild:function(e){if(!Menu.children[e])return;Menu.children[e].children("a:first, span:first").removeClass("opened").end().children("."+Menu.className).hide()},load:function(e,t){if(Menu.data[e])return;$.ajax({url:Core.baseUrl+t,dataType:"json",success:function(t){Menu.data[e]=t,Menu.dataIndex[e]={},Menu._populate(t,e);var n=$(".ui-breadcrumb li a"),r=n.length-1;n.each(function(t){var n=$(this),i=n.attr("href").replace(Core.baseUrl,""),s=Menu.dataIndex[e][i];s&&(s.children&&r===t&&n.parent().addClass("children"),s.children||n.parent().addClass("childless"))})}}),Menu.config.dataUrl[e]=t},open:function(e,t,n){n=$.extend({},{set:"base"},n||{}),Menu.node=$(e);var r=Menu.dataIndex[n.set][t]||null;r&&r.children&&($("#"+Menu._id(t,n.set)).is(":visible")?Menu.hide():Menu._display(t,n))},show:function(e,t,n){n=$.extend({},{set:"base"},n||{});if(!Menu.dataIndex[n.set][t])return;if($("#"+Menu._id(t,n.set)).is(":visible"))return;Menu.hide(),Menu.node=$(e),Menu.openTimer=window.setTimeout(function(){Menu._display(t,n)},200),Menu.node.unbind("mouseleave mouseenter").mouseleave(function(){window.clearTimeout(Menu.openTimer),Menu.timer=window.setTimeout(function(){Menu.hide()},Menu.config.duration)}).mouseenter(function(){window.clearTimeout(Menu.timer)})},_build:function(e,t,n){var r=$("<div>").addClass(Menu.className),i=[];n&&r.attr("id",n),$.each(t.children,function(e,n){var r=n.url?"a":"span",s=$("<li/>"),o=$("<"+r+"/>",Menu._prepare(n)).appendTo(s);n.description&&o.append('<span class="desc">'+n.description+"</span>"),n.parentClass&&s.addClass(n.parentClass),n.children&&o.addClass("children").append('<span class="child-arrow"></span>'),s.hover(function(){Menu.hideChild(t.url);if(n.children){var e=$(this);e.children("a:first, span:first").addClass("opened"),e.find("."+Menu.className).length===0&&Menu._build(this,n,!1),Menu._position(e.children("."+Menu.className)),Menu.children[t.url]=e,window.clearTimeout(Menu.timers[t.url])}},function(){n.children&&(Menu.timers[t.url]=window.setTimeout(function(){Menu.hideChild(t.url)},Menu.config.duration))});var u=Math.ceil((e+1)/Menu.config.colMax)-1;t.children.length<=Menu.config.colMax+3&&(u=0),i[u]||(i[u]=$("<ul/>")),s.appendTo(i[u])});for(var s=0;s<=i.length-1;++s)$(i[s]).appendTo(r);i.length>1&&r.css("width",i.length*Menu.config.colWidth),r.appendTo(e)},_display:function(e,t){if(!Menu.dataIndex[t.set][e])return;var n=Menu.dataIndex[t.set][e],r=t.center||t===!0,i=Menu._id(e,t.set);if(n&&n.children){var s=$("#"+i);s.length>0?s.fadeIn("fast"):Menu._build(Menu.container,n,i),Menu.node.addClass("opened");var o=Menu.node.parent().offset(),u=Menu.node.parent().width(),a=o.left,f=o.top+Menu.node.outerHeight(),l={top:f+"px",position:"absolute",visibility:"visible",zIndex:"75"};if(r){var c=Math.round(u/2)-Math.round(Menu.config.colWidth/2);l.left=a+c+"px"}else l.left=a+"px";Menu.container.css(l).show()}},_id:function(e,t){var n=Menu.idName+"-"+t;return Menu.dataIndex[t][e].id&&(n+=Menu.dataIndex[t][e].id),n},_position:function(e){e.show();if(e.find("ul").length<=1){var t=e.offset(),n=e.outerWidth(),r=t.left+n;r>=Page.dimensions.width&&e.css("left",-n)}},_populate:function(e,t){Menu.dataIndex[t][e.url]||(e.id=e.url?e.url.replace(/[^\-a-zA-Z0-9\/]/ig,""):"",e.id=e.id.replace(/\//ig,"-"),e.id.substr(-1)==="-"&&(e.id=e.id.substr(0,e.id.length-1)),Menu.dataIndex[t][e.url]=e);if(e.children)for(var n=0,r;r=e.children[n];n++)Menu._populate(r,t)},_prepare:function(e){var t=e.label||"",n={html:t.replace(/&/ig,"&amp;"),rel:"np"},r={};return e.url!==null&&(n.href=Core.baseUrl+e.url),$.each(n,function(e,t){t&&(r[e]=t)}),r}},Overlay={cache:{},config:{ajax:!1,bindClose:!0,className:"",fadeSpeed:250,blackout:!0},loaded:null,wrapper:null,initialize:function(){if(Overlay.loaded&&Overlay.wrapper)return;Overlay.wrapper=$("<div/>",{id:"overlay","class":"ui-overlay"}).appendTo("body").hide(),$("<a/>").addClass("overlay-close").attr("href","javascript:;").click(Overlay.close).appendTo(Overlay.wrapper);var e=$("<div/>").addClass("overlay-top").appendTo(Overlay.wrapper),t=$("<div/>").addClass("overlay-bottom").appendTo(e),n=$("<div/>").addClass("overlay-middle").appendTo(t);Overlay.loaded=!0},close:function(e){e=e?e||250:10,$("#blackout").fadeOut(e),Overlay.wrapper.fadeOut(e,function(){Overlay.setContent(""),Overlay.wrapper.attr("class","ui-overlay"),Overlay.wrapper.attr("id")!=="overlay"&&Overlay.wrapper.hide()})},open:function(e,t){Overlay.initialize(),t=$.extend({},Overlay.config,t),t.className&&Overlay.wrapper.addClass(t.className),t.blackout&&(t.bindClose?Blackout.show(null,function(){Overlay.close(t.fadeSpeed)}):Blackout.show()),t.ajax?Overlay.cache[e]?(Overlay.show(Overlay.cache[e]),$("#overlay").trigger("overlayLoaded")):$.ajax({type:"GET",url:e,dataType:"html",beforeSend:function(){Overlay.reset(),Overlay.show()},success:function(t,n){Overlay.cache[e]=t,Overlay.setContent(t),$("#overlay").trigger("overlayLoaded")}}):e.substr(0,1)==="#"?Overlay.show($(e).html()):Overlay.show(e)},openCustom:function(e,t){Overlay.wrapper=$(e),Overlay.wrapper&&(t=$.extend({},Overlay.config,t),t.blackout&&(t.bindClose?Blackout.show(null,function(){Overlay.close(t.fadeSpeed)}):Blackout.show()),Overlay.position())},position:function(e){e=e||Overlay.wrapper;var t=e.outerWidth(),n=e.outerHeight(),r=Page.dimensions.width/2-t/2,i=Page.dimensions.height/2-n/2;Core.isIE(6)&&(i=Page.scroll.top+i),e.show().css({left:r+"px",top:i+"px",position:Core.isIE(6)?"absolute":"fixed"})},reset:function(){Overlay.wrapper.find(".overlay-middle").html("").addClass("overlay-loading")},show:function(e){Overlay.setContent(e),Overlay.position()},setContent:function(e){e!=null&&(e===""?Overlay.wrapper.find("overlay-middle").empty():Overlay.wrapper.find(".overlay-middle").html(e))}},Page={object:null,loaded:!1,dimensions:{width:0,height:0},scroll:{top:0,width:0},initialize:function(){if(Page.loaded)return;Page.object||(Page.object=$(window)),Page.object.resize(Page.getDimensions).scroll(Page.getScrollValues),Page.getScrollValues(),Page.getDimensions(),Page.loaded=!0},getScrollValues:function(){Page.scroll.top=Page.object.scrollTop(),Page.scroll.left=Page.object.scrollLeft()},getDimensions:function(){Page.dimensions.width=Page.object.width(),Page.dimensions.height=Page.object.height()}};$(function(){Page.initialize()});var Prompt={node:null,input:null,title:null,errors:null,initialized:!1,defaults:{minLength:{value:1},maxLength:{value:25},numeric:{value:!1}},rules:{},callback:null,initialize:function(){Prompt.node=$("<div/>").addClass("ui-prompt").click(Core.stopPropagation).appendTo("body");var e=$("<form/>").attr("method","post").attr("action","").addClass("prompt-inner").appendTo(Prompt.node).submit(Core.preventDefault).keyup(function(e){e.which===KeyCode.enter&&Prompt.validate()});Prompt.title=$("<h3/>").addClass("subheader").text("").appendTo(e),Prompt.input=$("<input/>").addClass("input").appendTo(e).focus(Input.activate).blur(Input.reset),Prompt.errors=$("<ul/>").addClass("prompt-errors").hide().appendTo(e);var t=$("<div/>").addClass("prompt-buttons").appendTo(e);$('<button type="button"/>').addClass("ui-button button1").html('<span class="button-left"><span class="button-right">'+Msg.ui.submit+"</span></span>").click(Prompt.validate).appendTo(t),$('<button type="button"/>').addClass("ui-button button1").html('<span class="button-left"><span class="button-right">'+Msg.ui.cancel+"</span></span>").click(Prompt.close).appendTo(t),$(document).bind("keyup.prompt",function(e){e.which===KeyCode.esc&&Prompt.close()}),Prompt.initialized=!0},open:function(e,t,n){Prompt.initialized||Prompt.initialize();var r=Prompt.node.outerWidth(),i=Prompt.node.outerHeight(),s=Page.dimensions.width/2-r/2,o=Page.dimensions.height/2-i/2+Page.scroll.top;Prompt.rules=$.extend({},Prompt.defaults,n||{}),Prompt.callback=t,Prompt.title.text(e),Prompt.input.attr("maxlength",Prompt.rules.maxLength.value),Prompt.node.css({top:o,left:s}).show(),Blackout.show(function(){Prompt.input.focus()},Prompt.close)},close:function(){Prompt.input.val("").trigger("blur"),Prompt.errors.empty().hide(),Prompt.node.hide(),Blackout.hide()},validate:function(){var e=Prompt.input,t=e.val().trim(),n=!0,r=[],i,s=0,o=0;for(var u in Prompt.rules){i=Prompt.rules[u],n=!0;if(!i)continue;if(typeof i.value=="function")n=i.value(t);else switch(u){case"minLength":i.value&&t.length<i.value&&(n=!1);break;case"maxLength":i.value&&t.length>i.value&&(n=!1);break;case"numeric":i.value&&isNaN(t)&&(n=!1)}n||r.push(i.message||u)}if(r.length){Prompt.errors.empty().show();for(s=0,o=r.length;s<o;s++)$("<li/>").text(r[s]).appendTo(Prompt.errors)}else Core.isCallback(Prompt.callback)&&Prompt.callback(t),Prompt.close()}},Search={ta:null,map:{articlekeyword:"article",blog:"article",product:"product","static":"static",friend:"friend"},initialize:function(e,t){var n=[];Core.project==="wow"?(n=["friend","url","wowcharacter","wowguild","wowarenateam","wowitem","article","static","other"],Search.map.character="wowcharacter",Search.map.arenateam="wowarenateam",Search.map.guild="wowguild",Search.map.wowitem="wowitem",Search.map.item="wowitem",Search.map.friend="wowcharacter"):n=["friend","url","product","article","static","other","kb"],Search.ta=TypeAhead.factory(t||"#search-field",{groupResults:!0,resultTypes:n,ghostQuery:Core.region==="us"||Core.region==="eu"||Core.region==="sea",source:function(t,n){$.ajax({url:e,data:{term:t,locale:Core.formatLocale(2,"_"),community:Core.project},cache:!0,dataType:e.charAt(0)==="/"?"json":"jsonp",success:function(e){var t=[];if(e.results)for(var r=0,i;i=e.results[r];r++){var s="",o=$("<div/>").html(i.title||i.term);o&&(s=o.text());var u={type:Search.map[i.type]||"url",title:s,desc:"",url:"",icon:""};switch(i.type){case"character":u.desc=i.realmName,u.url=Core.baseUrl+"/character/"+i.realmName.replace(/[^a-z0-9]/ig,"-").toLowerCase()+"/"+i.term+"/";break;case"arenateam":u.desc=i.realmName,u.url=Core.baseUrl+"/arena/"+i.realmName.replace(/[^a-z0-9]/ig,"-").toLowerCase()+"/"+i.teamSize+"/"+i.term+"/";break;case"guild":u.desc=i.realmName,u.url=Core.baseUrl+"/guild/"+i.realmName.replace(/[^a-z0-9]/ig,"-").toLowerCase()+"/"+i.term+"/";break;case"wowitem":case"item":u.className="color-q"+i.rarity,u.desc=Core.msg(Msg.cms.ilvl,i.level),u.url=Core.baseUrl+"/item/"+i.objectId;break;case"url":case"product":u.desc=i.desc,u.icon=i.icon,u.url=i.url;break;case"friend":u.url=Core.projectUrl+i.url,u.icon=Core.projectUrl+i.icon;break;default:u.url="",i.url&&(u.url=$("<div/>").html(i.url).text()),u.title!==i.term&&(u.desc=i.term||"")}t.push(u)}n(t)}})}})}},Storage={initialized:window.localStorage,get:function(e){return Storage.initialized&&e?localStorage.getItem(e):null},getAll:function(e){var t=[];if(!Storage.initialized)return t;for(var n=0,r=localStorage.length,i=null;n<r;n++){i=localStorage.key(n);if(e&&i.indexOf(e)!==0)continue;t.push({key:i,value:localStorage[i]})}return t},has:function(e){return Storage.get(e)!==null},set:function(e,t){if(Storage.initialized&&e){try{localStorage.setItem(e,t||"")}catch(n){n===QUOTA_EXCEEDED_ERR&&alert("Local storage quota exceeded, please clear your saved data.")}return!0}return!1},clear:function(){Storage.initialized&&localStorage.clear()},remove:function(e){Storage.initialized&&e&&localStorage.removeItem(e)},size:function(e){return e?Storage.getAll(e).length:localStorage.length||0}},Tickets={tag:null,summary:null,fragment:null,ul:null,doc:null,total:3,initialize:function(){Tickets.doc=document;var e=Tickets.doc;Tickets.tag=e.getElementById("support-ticket-count"),Tickets.summary=e.getElementById("ticket-summary"),Tickets.fragment=e.createDocumentFragment(),Tickets.ul=e.createElement("ul"),Tickets.loadStatus()},updateSummary:function(e){var t=Tickets.doc;Tickets.fragment=t.createDocumentFragment(),Tickets.ul=t.createElement("ul"),Tickets.summary.innerHTML="",Tickets.fragment.appendChild(Tickets.ul);if(e.length<1)return;for(var n=0,r;r=e[n];n++)Tickets.createListItem(r,n);Tickets.summary.appendChild(Tickets.fragment)},createListItem:function(e,t){if(typeof e!="object")return;var n=Tickets.doc,r=Core.isIE(6)||Core.isIE(7)?"className":"class",i=Msg.support,s={created:i.ticketNew,status:i.ticketStatus,viewAll:i.ticketAll,OPEN:i.ticketOpen,ANSWERED:i.ticketAnswered,RESOLVED:i.ticketResolved,CANCELED:i.ticketCanceled,ARCHIVED:i.ticketArchived,INFO:i.ticketInfo},o="",u="",a="",f=null,l=null,c=null,h=null,p=null,d=null,v=-1;e.status==="OPEN"?o=s.created.replace("{0}",Core.region.toUpperCase()+e.caseId):o=s.status.replace("{0}",Core.region.toUpperCase()+e.caseId),d=n.createElement("span"),d.setAttribute(r,"ticket-datetime"),d.appendChild(n.createTextNode(Tickets.localizeDatetime(e.lastUpdate))),c=n.createElement("a"),c.href=Core.secureSupportUrl+"ticket/thread/"+e.caseId,f=n.createElement("span"),f.setAttribute(r,"icon-ticket-status"),c.appendChild(f),v=o.indexOf("{1}"),v>0?(u=o.substring(0,v),a=o.substr(v+3,o.length),h=n.createElement("span"),h.setAttribute(r,"ticket-"+e.status.toLowerCase()),h.appendChild(n.createTextNode(s[e.status])),c.appendChild(n.createTextNode(u)),c.appendChild(h),c.appendChild(n.createTextNode(a))):c.appendChild(n.createTextNode(o)),p=n.createElement("br"),c.appendChild(p),c.appendChild(d),l=n.createElement("li"),t===0&&l.setAttribute(r,"first-ticket"),l.appendChild(c),Tickets.ul.appendChild(l),t===this.total&&(l=n.createElement("li"),l.setAttribute(r,"view-all-tickets"),c=n.createElement("a"),c.href=Core.secureSupportUrl+"ticket/status",c.appendChild(n.createTextNode(s.viewAll)),l.appendChild(c),Tickets.ul.appendChild(l))},updateTotal:function(e){e=typeof e=="number"?e:0;var t=Core.isIE(6)||Core.isIE(7)?"className":"class";e>0?(Tickets.tag.setAttribute(t,"open-support-tickets"),Tickets.tag.innerHTML=e):(Tickets.tag.setAttribute(t,"no-support-tickets"),Tickets.tag.innerHTML="")},localizeDatetime:function(e){var t=Core.dateTimeFormat,n=Core.locale,r=null;r=Core.formatDatetime(t,e);if(!r)return"";if(n==="en-us"||n==="es-mx"||n==="zh-cn"||n==="zh-tw")r=r.replace("/0","/"),r.substr(0,1)==="0"&&(r=r.substr(1));if(n==="en-us"||n==="es-mx")r=r.replace(" 0"," ");return r},loadStatus:function(){Tickets.summary!==null&&$.ajax({timeout:3e3,url:Core.secureSupportUrl+"update/json",ifModified:!0,global:!1,dataType:"jsonp",jsonpCallback:"getStatus",data:{supportToken:supportToken},success:function(e){Tickets.updateTotal(e.total),Tickets.updateSummary(e.details,e.total)}})}};$(function(){Tickets.initialize()});var Toast={container:null,initialized:!1,max:5,options:{timer:15e3,autoClose:!0,onClick:null},initialize:function(){Toast.container=$("<div/>").attr("id","toast-container").show().appendTo("body"),Toast.initialized=!0},create:function(e){var t=$("<div/>").addClass("ui-toast");return $("<div/>").addClass("toast-arrow").appendTo(t),$("<div/>").addClass("toast-top").appendTo(t),$("<div/>").addClass("toast-content").appendTo(t).html(e),$("<div/>").addClass("toast-bot").appendTo(t),$("<a/>").addClass("toast-close").attr("href","javascript:;").appendTo(t).click(function(e){e.preventDefault(),e.stopPropagation(),Toast.options.fadeUse?$(this).parent(".ui-toast").fadeOut("normal",function(){$(this).remove()}):$(this).parent(".ui-toast").remove()}),t},show:function(e,t){Toast.initialized||Toast.initialize(),Toast.truncate();var n=Toast.create(e);t=$.extend({},Toast.options,t),t.autoClose?window.setTimeout(function(){n.fadeOut("normal",function(){n.remove()})},t.timer):n.click(function(){n.fadeOut("normal",function(){n.remove()})}).css("cursor","pointer"),Core.isCallback(t.onClick)&&n.click(t.onClick).css("cursor","pointer"),n.fadeIn()},truncate:function(){var e=Toast.container.find(".ui-toast");e.length>Toast.max&&Toast.container.find(".ui-toast:lt("+Math.round(e.length-Toast.max)+")").fadeOut()}},Toggle={cache:{},callback:null,timeout:800,keepOpen:!1,open:function(e,t,n,r){r&&(Toggle.timeout=r),Toggle.keepOpen=!0;var i=Toggle.key(n);for(var s in Toggle.cache)s!==i&&Toggle.close(Toggle.cache[s].trigger,Toggle.cache[s].activeClass,Toggle.cache[s].target,0,!0);Toggle.cache[i]||($(e).mouseleave(function(){Toggle.keepOpen=!1,Toggle.close(e,t,n,Toggle.timeout)}).mouseenter(function(){Toggle.keepOpen=!0,window.clearTimeout(Toggle.cache[i].timer)}),$(n).mouseleave(function(){Toggle.keepOpen=!1,Toggle.close(e,t,n,Toggle.timeout)}).mouseenter(function(){Toggle.keepOpen=!0,window.clearTimeout(Toggle.cache[i].timer)}),Toggle.cache[i]={trigger:e,target:n,activeClass:t,key:i,timer:null}),$(e).toggleClass(t),$(n).toggle(),window.clearTimeout(Toggle.cache[i].timer)},close:function(e,t,n,r,i){i=typeof i=="boolean"?i:!1;var s=Toggle.key(n);window.clearTimeout(Toggle.cache[s].timer),Toggle.cache[s].timer=setTimeout(function(){if(Toggle.keepOpen&&!i)return;$(n).hide(),$(e).removeClass(t),Toggle.triggerCallback()},r)},key:function(e){return typeof e=="string"?e:"#"+$(e).attr("id")},triggerCallback:function(){Core.isCallback(Toggle.callback)&&Toggle.callback()}},Tooltip={wrapper:null,wrapperFrame:null,contentCell:null,cache:{},currentNode:null,visible:!1,options:{},query:null,maxWidth:250,threshold:100,initialized:!1,instances:{},factory:function(e,t){var n=Object.create(Tooltip);return n.init(e,t),Tooltip.instances[t.key||e]=n,n},init:function(e,t){this.query=e,this.options=$.extend({},{ajax:!1,mode:"hover",className:"",location:"topRight",useTable:!1,showLoading:!0,onShow:null,onPosition:null,context:null,margin:10},t),Core.project==="sc2"&&(this.options.useTable=!0),t=this.options;var n=$("<div/>").addClass("ui-tooltip").appendTo("body").hide();Core.isIE(6)&&(this.wrapperFrame=$("<iframe/>",{src:'javascript:"";',frameborder:0,scrolling:"no",marginwidth:0,marginheight:0}).addClass("tooltip-frame").appendTo("body"));if(!t.useTable)this.contentCell=$("<div/>").addClass("tooltip-content").appendTo(n);else{var r=$("<table/>",{cellspacing:0,cellpadding:0}).appendTo(n),i=$("<td/>").attr("valign","top").text(" "),s=$("<tr/>"),o=i.clone();r.append(s.clone().append(i.clone().addClass("top-left")).append(i.clone().addClass("top-center")).append(i.clone().addClass("top-right"))).append(s.clone().append(i.clone().addClass("middle-left")).append(o.addClass("middle-center")).append(i.clone().addClass("middle-right"))).append(s.clone().append(i.clone().addClass("bottom-left")).append(i.clone().addClass("bottom-center")).append(i.clone().addClass("bottom-right"))),this.contentCell=o}this.wrapper=n;var u=t.mode==="click"?"click":"mouseover",a=typeof t.onShow=="function"?t.onShow:function(e){var t=$(e.currentTarget),n=t.data("tooltip")||t.prop("title");if(u==="click"&&this.visible){this.hide();return}n&&t.attr("rel")!=="np"&&this.show(t,n,t.data("tooltip-options")||this.options)};$(t.context||document).off(u+".tooltip",e,$.proxy(a,this)).on(u+".tooltip",e,$.proxy(a,this)),this.initialized=!0},show:function(e,t,n){if(!this.initialized){Tooltip.instances.common.show(e,t,n);return}n===!0&&(n={ajax:!0}),n=$.extend({},this.options,n||{}),this.currentNode=e=$(e),n.mode!=="click"&&e.unbind("mouseout.tooltip").bind("mouseout.tooltip",$.proxy(function(){this.hide(),this.wrapper.removeClass(n.location).removeClass(n.className)},this)),this["_"+n.location]||(n.location="topRight"),n.location===this.options.location&&e.offset().left>$(window).width()/2&&(n.location="topLeft"),this.wrapper.addClass(n.location),n.className&&this.wrapper.addClass(n.className);if(typeof t=="object")this._position(e,t,n);else if(typeof t=="string")if(n.ajax)if(this.cache[t])this._position(e,this.cache[t],n);else{var r=t;r.indexOf(Core.projectUrl)!==0&&(r=Core.baseUrl+t),n.showLoading&&window.setTimeout($.proxy(function(){!this.visible&&!this.cache[t]&&this._position(e,Msg.ui.loading,n)},this),500),$.ajax({type:"GET",url:r,dataType:"html",global:!1,success:$.proxy(function(r){this.cache[t]=r,this.currentNode===e&&this._position(e,r,n)},this),error:$.proxy(function(e){e.status!==200&&this.hide()},this)})}else t.substr(0,1)==="#"?this._position(e,$(t).html(),n):this._position(e,t,n)},hide:function(){if(this.initialized)Core.isIE(6)&&(this.wrapperFrame.hide(),this.wrapper.removeAttr("style")),this.wrapper.hide().unbind("mousemove.tooltip").removeClass(this.options.location).removeClass(this.options.className),this.currentNode=null,this.visible=!1;else for(var e in Tooltip.instances)Tooltip.instances[e].hide()},move:function(e,t,n,r){this.wrapper.css("left",e+"px").css("top",t+"px").show(),this.visible=!0,Core.isIE(6)&&(this.wrapperFrame.css({width:n+60,height:r,left:e-60+"px",top:t+"px"}).fadeTo(0,0).show(),this.wrapper.css("width",n))},_position:function(e,t,n){typeof n.onPosition=="function"&&(t=n.onPosition(t)),typeof t=="string"?this.contentCell.html(t):this.contentCell.empty().append(t);var r=this.wrapper.outerWidth(),i=this.wrapper.outerHeight();Core.isIE(6)&&r>Tooltip.maxWidth&&(r=Tooltip.maxWidth);var s=this["_"+n.location](r,i,e);s&&this.move(s.x,s.y,r,i)},_mouse:function(e,t,n){n.unbind("mousemove.tooltip").bind("mousemove.tooltip",$.proxy(function(n){var r=this.options.margin;this.move(n.pageX+r,n.pageY+r,e,t)},this))},_topLeft:function(e,t,n){var r=n.offset(),i=r.left-e,s=r.top-t;return this._checkViewport(i,s,e,t,n)},_topCenter:function(e,t,n){var r=n.offset(),i=n.outerWidth(),s=r.left+(i/2-e/2),o=r.top-t-5;return this._checkViewport(s,o,e,t,n)},_topRight:function(e,t,n){var r=n.offset(),i=n.outerWidth(),s=r.left+i,o=r.top-t;return this._checkViewport(s,o,e,t,n)},_middleLeft:function(e,t,n){var r=n.offset(),i=n.outerHeight(),s=r.left-e,o=r.top+i/2-t/2;return this._checkViewport(s,o,e,t,n)},_middleRight:function(e,t,n){var r=n.offset(),i=n.outerWidth(),s=n.outerHeight(),o=r.left+i,u=r.top+s/2-t/2;return this._checkViewport(o,u,e,t,n)},_bottomLeft:function(e,t,n){var r=n.offset(),i=n.outerHeight(),s=r.left-e,o=r.top+i;return this._checkViewport(s,o,e,t,n)},_bottomCenter:function(e,t,n){var r=n.offset(),i=n.outerWidth(),s=n.outerHeight(),o=r.left+(i/2-e/2),u=r.top+s+5;return this._checkViewport(o,u,e,t,n)},_bottomRight:function(e,t,n){var r=n.offset(),i=n.outerWidth(),s=n.outerHeight(),o=r.left+i,u=r.top+s;return this._checkViewport(o,u,e,t,n)},_checkViewport:function(e,t,n,r,i){var s=i.offset(),o=Page.scroll,u=Page.dimensions,a=this.options.margin;return e+n>u.width&&(e=u.width-n),e<0&&(e=a),t+r>o.top+u.height?t-=t+r-(o.top+u.height):s.top-Tooltip.threshold<o.top?t=s.top+i.outerHeight():t<o.top&&(t=o.top+a),t<0&&(t=a),{x:e,y:t}}};$(function(){Tooltip.factory("[data-tooltip]",{key:"common"})});var TypeAhead={node:null,html:null,timer:null,term:"",position:-1,items:[],cache:[],config:{},factory:function(e,t){var n=Object.create(TypeAhead);return n.init(e,t),n},init:function(e,t){this.node=$(e);if(!this.node.length)return!1;this.config=$.extend({},{minLength:3,resultsLength:15,groupResults:!1,termMatch:!1,resultTypes:[],ghostQuery:!1,selectKey:KeyCode.enter,throttle:200,source:null,onSelect:function(e,t){t.node.val(e.title||""),t.close()},onStart:null,onFinish:null},t||{}),this.config.minLength<=0&&(this.config.minLength=1),this.config.resultTypes.push("default"),this.node.prop("nodeName").toLowerCase()==="input"&&(this.node.bind("keyup.ta",$.proxy(this.listen,this)),this.node.bind("keydown.ta",$.proxy(this.trigger,this)),this.html=$("<div/>").addClass("ui-typeahead").html(Msg.ui.loading).hide().appendTo("body"),this.config.ghostQuery&&(this.ghost=$("<input/>").attr({type:"text",value:"",autocomplete:"off",readonly:"readonly","class":this.node.attr("class")}).addClass("input input-ghost").focus(function(){$(e).focus()}),this.node.css("background-color","transparent").wrap($("<div/>").addClass("ui-typeahead-ghost")).before(this.ghost)),$(document).bind("click.ta",$.proxy(this.close,this)),this.node.bind("click.ta",Core.stopPropagation),this.html.bind("click.ta",Core.stopPropagation))},close:function(){this.position=-1,this.html.hide(),this._setGhostText()},finish:function(e){var t=this.config;this.items=e||[],this.cache=[],this._populate(),this._position(),Core.isCallback(t.onFinish)&&t.onFinish(this.term,this)},highlight:function(e){var t=this.term.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&").split(" ");for(var n=0,r;r=t[n];n++)e=e.replace(new RegExp(r,"ig"),function(e){return"<em>"+e+"</em>"});return e},listen:function(){this.term=this.node.val(),this.term.length<=0?this.close():this._checkGhostText()},start:function(){var e=this.config,t=$.type(e.source);Core.isCallback(e.onStart)&&e.onStart(this.term,this),t==="function"?e.source(this.term,$.proxy(this.finish,this)):t==="array"&&this.finish(e.source)},throttle:function(){this.timer!==null&&(window.clearTimeout(this.timer),this.timer=null),this.timer=window.setTimeout($.proxy(this.start,this),this.config.throttle)},trigger:function(e){var t=e.which,n=this.config,r=this.node.val();this._checkGhostText();if(t!==KeyCode.arrowUp&&t!==KeyCode.arrowDown&&t!==n.selectKey&&t!==KeyCode.tab){r.length+1>=this.config.minLength?(this.term=r.trim(),this.throttle()):r.length<=0&&this.close();return}t!==KeyCode.enter||!this.html.is(":hidden")&&this.position!==-1?(e.preventDefault(),e.stopPropagation()):this.node.parentsUntil("form").parent().submit();var i=this.cache,s=this.html.find("a");s.removeClass("item-active"),this._setGhostText();if(t===n.selectKey){if(this.position!=-1&&i[this.position]){var o=i[this.position];Core.isCallback(n.onSelect)?n.onSelect(o,this):o.url&&Core.goTo(o.url)}}else t===KeyCode.arrowDown?(this.position++,this.position>=s.length&&(this.position=0)):t===KeyCode.arrowUp?(this.position--,this.position<=-1&&(this.position=s.length-1)):t===KeyCode.tab&&(this.position=0),i[this.position]&&(s.eq(this.position).addClass("item-active"),this.node.val(i[this.position].title))},_position:function(){if(!this.items.length){this.close();return}var e=this.node.offset();this.html.css({width:this.node.outerWidth(),left:e.left,top:e.top+this.node.outerHeight()}).show()},_populate:function(){if(!this.items.length)return;this.html.empty(),this.position=-1;var e=this.config,t=this.items,n=this.term,r={};if(e.groupResults)for(var i=0,s;s=t[i];i++)r[s.type]||(r[s.type]=[]),r[s.type].push(s);else r["default"]=t;var o,u,a,f,l=0;for(var i=0,c;c=e.resultTypes[i];i++){if(l>=e.resultsLength)break;if(r[c]){var h=!1;u=$("<ul/>");for(var p=0,d;d=r[c][p];p++){if(l>=e.resultsLength)break;if(e.termMatch&&d.title.toLowerCase().indexOf(n.toLowerCase())<=-1)continue;f='<span class="title">'+this.highlight(d.title)+"</span>",d.desc&&(f+=' <span class="desc">'+d.desc+"</span>"),a=$("<a/>",{href:d.url,html:f,"class":d.className||""});if(d.icon){var v=$("<img/>",{src:d.icon,width:c==="product"?100:38,height:c==="product"?50:38,"class":"icon"});a.html($('<div class="icon-desc"/>').append(a.html())),a.prepend(v),a.append($('<span class="clear"/>'))}$("<li/>").append(a).appendTo(u),l++,h=!0,this.cache.push(d)}h&&(o=$("<div/>").addClass("group-list group-"+c),Msg.search&&Msg.search[c]&&$("<span/>").addClass("group-title").html(Msg.search[c]).appendTo(o),o.append(u).appendTo(this.html))}}l&&this._checkGhostText()},_setGhostText:function(e){this.ghost&&this.ghost.val(e||"")},_checkGhostText:function(){if(this.ghost)if(this.cache[0]){var e=this.cache[0].title.trim(),t=this.node.val().trim();e.toLowerCase().indexOf(t.toLowerCase())===0?e=t+e.substr(t.length,e.length-t.length):e="",this._setGhostText(e)}else this._setGhostText()}}