/**
 * Password validation and strength rating.
 *
 * @copyright   2011, Blizzard Entertainment, Inc
 * @class       Password
 */var Password=Class.extend({passwordPattern1:new RegExp,passwordPattern2:new RegExp,maxRepetition:0,maxSequentiality:0,maxSimilarity:0,config:{},init:function(e){e=typeof e!="undefined"?e:{},this.config=$.extend({passwordPattern1:new RegExp("^[ -~]+$"),passwordPattern2:new RegExp("^(?=.*[0-9]+.*)(?=.*[a-zA-Z]+.*).+$"),maxRepetition:2,maxSequentiality:4,maxSimilarity:4},e),e=this.config,this.passwordPattern1=e.passwordPattern1,this.passwordPattern2=e.passwordPattern2,this.maxRepetition=e.maxRepetition,this.maxSequentiality=e.maxSequentiality,this.maxSimilarity=e.maxSimilarity},check:function(e,t,n){e=typeof e!="undefined"?e:"",t=typeof t!="undefined"?t:"",n=typeof n!="undefined"?n:"";var r=[0,0,0,0,0];return e.length>0&&(e.length>=8&&e.length<=16?r[0]=1:r[0]=-1,this.passwordPattern1.test(e)?r[1]=1:r[1]=-1,this.passwordPattern2.test(e)?r[2]=1:r[2]=-1,r[3]=this.isSimilar(e,n),t===""?r[4]=0:e===t?r[4]=1:r[4]=-1),r},isSimilar:function(e,t){if(e===""||t===""||e.length<this.maxSimilarity)return 1;e=e.toLowerCase(),t=t.toLowerCase();for(var n=0;n<=t.length-this.maxSimilarity;n++)if(e.indexOf(t.substring(n,n+this.maxSimilarity))>-1)return-1;return 1},rate:function(e){e=typeof e!="undefined"?e:"";var t=0;return e.length>0&&(e.length>=8?this.passwordPattern1.test(e)&&this.passwordPattern2.test(e)&&e.length>10&&!this.hasRepetition(e)&&!this.hasSequentiality(e)?t=4:this.passwordPattern1.test(e)&&this.passwordPattern2.test(e)&&e.length>8&&!this.hasRepetition(e)&&!this.hasSequentiality(e)?t=3:t=2:t=1),t},hasRepetition:function(e){e=typeof e!="undefined"?e:"",t=typeof t!="undefined"?t:2;var t=this.maxRepetition,n="",r;for(var i=0,s=e.length;i<s;i++){r=!0;for(var o=0;o<t&&o+i+t<e.length;o++)r=r&&e.charAt(o+i)===e.charAt(o+i+t);o<t&&(r=!1),r?(i+=t-1,r=!1):n+=e.charAt(i)}return n.length-e.length<0},hasSequentiality:function(e){e=typeof e!="undefined"?e.toLowerCase():"";var t=this.maxSequentiality,n="abcdefghijklmnopqrstuvwxyz",r=n.split("").reverse().join(""),i="1234567890",s=i.split("").reverse().join(""),o="qwertyuiopasdfghjklzxcvbnm!@#$%^&*()_+",u=o.split("").reverse().join(""),a=" "+e.slice(0,t-1);for(var f=t,l=e.length;f<l;f++){a=a.slice(1)+e.charAt(f);if(n.indexOf(a)>-1||i.indexOf(a)>-1||o.indexOf(a)>-1||r.indexOf(a)>-1||s.indexOf(a)>-1||u.indexOf(a)>-1)return!0}return!1}}),Email=Class.extend({emailPattern:new RegExp,config:{},init:function(e){e=typeof e!="undefined"?e:{},this.config=$.extend({emailPattern:new RegExp("^[0-9a-zA-Z+_.-]+@[0-9a-zA-Z_-]+\\.[0-9a-zA-Z_.-]+$")},e),this.emailPattern=this.config.emailPattern},check:function(e,t){e=typeof e!="undefined"?e:"",t=typeof t!="undefined"?t:"";var n=[0,0];return e===""?n[0]=0:this.emailPattern.test(e)?n[0]=1:n[0]=-1,e===""?n[1]=0:e===t?n[1]=1:n[1]=-1,n}}),Creation=Class.extend({form:null,submitButton:null,countrySelect:null,countryWarning:null,countrySubmit:null,countryCancel:null,countryDefault:null,countryBlockable:null,countryBlock:null,countryOriginal:null,countryBlocked:null,emailInput1:null,emailMessage1:null,emailInput2:null,emailMessage2:null,emailRight:null,emailLeft:null,emailValidator:new Email,emailValidated:!1,emailTimer:null,activeEmailInput:-1,autocompleteOptions:{},contactInput1:null,contactMessage1:null,contactInput2:null,contactMessage2:null,contactRight:null,contactLeft:null,contactValidated:!1,contactTimer:null,contactInfo:null,showContactInfo:!1,activeContactInput:-1,battleTagInput1:null,battleTagMessage1:null,battleTagTimer:null,battleTagGuidelines:null,showbattleTagGuidelines:!1,passwordInput1:null,passwordMessage1:null,passwordMessage1Default:null,passwordInput2:null,passwordMessage2:null,passwordMessage2Default:null,passwordRight:null,passwordLeft:null,passwordResult:null,passwordRating:null,passwordLevels:[],passwordGuidelines:null,passwordValidator:new Password,passwordValidated:!1,passwordTimer:null,showPasswordGuidelines:!1,activePasswordInput:-1,activeInput:-1,secretQuestion:null,secretAnswer:null,secretInfo:null,secretTimer:null,showSecretInfo:!1,slideUpDuration:125,slideDownDuration:250,focusElements:null,warningLines:null,config:{},init:function(e,t){t=typeof t!="undefined"?t:{},e=$(e),e.length&&(e[0].tagName.toLowerCase()!=="form"&&(e=e.find("form")),this.form=e.length?e:null),this.form!==null&&(this.config=$.extend({showContactInfo:!1,contactFields:["#parentContactEmail","#parentContactEmailConfirmation"],emailFields:["#emailAddress","#emailAddressConfirmation"],battleTagFields:["#battleTag"],passwordFields:["#password","#rePassword"],secretFields:["#question1","#answer1"],domains:[]},t),this.setup())},setup:function(){var e=this.form;this.submitButton=e.find("button[type=submit]"),this.countrySelect=$("#country"),this.countrySelect.length&&(this.countryDefault=this.countrySelect.find(":selected")[0].value,this.countryWarning=$("#country-warning"),this.countryGlobal=$("#countryGlobal"),this.countryCHINA=$("#countryCHINA"),this.countrySubmit=this.countryWarning.find("a.ui-button"),this.countryCancel=this.countryWarning.find("a.ui-cancel"),this.countryBlockable=$("#country-change"),this.countryBlock=$("#country-change-overlay"),this.countryDefault||(this.countryBlockable.find("select, input").attr("disabled","disabled"),this.countryBlockable.find("a.input-checkbox").addClass("input-checkbox-disabled"),this.countryBlocked=!0)),this.emailInput1=$(this.config.emailFields[0]),this.emailMessage1=$(this.config.emailFields[0]+"-message"),this.emailInput2=$(this.config.emailFields[1]),this.emailMessage2=$(this.config.emailFields[1]+"-message"),this.emailRight=this.emailInput1.parents("span.input-right"),this.emailLeft=this.emailRight.siblings("span.input-left"),this.config.showContactInfo&&(this.contactInput1=$(this.config.contactFields[0]),this.contactMessage1=$(this.config.contactFields[0]+"-message"),this.contactInput2=$(this.config.contactFields[1]),this.contactMessage2=$(this.config.contactFields[1]+"-message"),this.contactRight=this.contactInput1.parents("span.input-right"),this.contactLeft=this.contactRight.siblings("span.input-left"),this.contactInfo=$("#contact-info")),this.passwordInput1=$(this.config.passwordFields[0]),this.passwordMessage1=$(this.config.passwordFields[0]+"-message"),this.passwordMessage1Default=this.passwordMessage1.text(),this.passwordInput2=$(this.config.passwordFields[1]),this.passwordMessage2=$(this.config.passwordFields[1]+"-message"),this.passwordMessage2Default=this.passwordMessage2.text(),this.passwordRight=this.passwordInput1.parents("span.input-right"),this.passwordLeft=this.passwordRight.siblings("span.input-left"),this.passwordResult=$("#password-result"),this.passwordRating=$("#password-rating"),this.passwordGuidelines=$("#password-strength"),this.battleTagInput1=$(this.config.battleTagFields[0]),this.battleTagMessage1=$(this.config.battleTagFields[0]+"-message"),this.battleTagGuidelines=$("#battlenet-id-note");for(var t=0;t<5;t++)this.passwordLevels[t]=$("#password-level-"+t);this.secretQuestion=$(this.config.secretFields[0]),this.secretAnswer=$(this.config.secretFields[1]),this.secretInfo=$("#question-info"),this.focusElements=$("body, label, select, input, a.input-checkbox, button"),this.warningLines=e.find(".inline-message");if(this.focusElements.length)for(var t=0,n=this.focusElements.length;t<n;t++){var r=$(this.focusElements[t]);r.is("select")&&r.bind("change",{form:this},function(e){e.stopPropagation(),e.data.form.toggleWarnings(this)}),r.bind("focus click",{form:this},function(e){$(this).is("a")||(e.stopPropagation(),e.data.form.toggleWarnings(this))})}this.countrySelect.length&&(this.countrySelect.bind("change",{form:this},function(e){e.data.form.changeCountry(e.target.value)}),this.countryCancel.bind("click",{form:this},function(e){return e.data.form.resetCountry(),!1})),this.form.bind("validate",{form:this},function(e){$("#emailAddress").val()&&document.activeElement.id!="emailAddress"&&document.activeElement.id!="emailAddressConfirmation"&&e.data.form.validateEmail(),$("#parentContactEmail").val()&&document.activeElement.id!="parentContactEmail"&&document.activeElement.id!="parentContactEmailConfirmation"&&(e.data.form.showContactInfo=!1,e.data.form.validateContact())}),this.form.bind("submit",{form:this},function(e){var t=!1,n=!1,r=!1,i=[],s="",o=$("#creation [required]");if(e.data.form.countryBlocked)i.push(FormMsg.selectCountry),e.data.form.toggleErrorFlag(e.data.form.countrySelect,!0);else for(var u=0,a=o.length;u<a;u++)s=o[u],s.value?s.id.indexOf("email")>-1&&!e.data.form.emailValidated?(r||(i.push(FormMsg.emailError1),r=!0),e.data.form.toggleErrorFlag(s,!0)):s.id.indexOf("password")>-1&&!e.data.form.passwordValidated?(i.push(FormMsg.passwordError1),e.data.form.toggleErrorFlag(s,!0)):s.type=="checkbox"&&!s.checked?(n||(i.push(FormMsg.touDisagree),n=!0),e.data.form.toggleErrorFlag(s,!0)):e.data.form.toggleErrorFlag(s,!1):(t||(i.push(FormMsg.fieldInvalid,FormMsg.fieldsMissing),t=!0),e.data.form.toggleErrorFlag(s,!0));return i.length?($("#content").prepend(e.data.form.makeErrorBox(i)),$("#password-strength").slideUp(e.data.form.slideUpDuration),$("#contact-info").slideUp(e.data.form.slideUpDuration),window.location.href="#form-errors",!1):!0});if(this.config.domains.length){this.autocompleteOptions={minChars:0,matchSubset:!1,matchContains:!0,source:[]};try{this.emailInput1.autocomplete(this.autocompleteOptions),this.emailInput2.autocomplete(this.autocompleteOptions)}catch(i){}}this.emailInput1.bind("focus",$.proxy(this._validateEmail,this)).bind("input propertychange",$.proxy(this._completeEmail,this)),this.emailInput2.bind("focus",$.proxy(this._validateEmail,this)).bind("input propertychange",$.proxy(this._completeEmail,this)),this.config.showContactInfo&&(this.contactInput1.bind("focus input propertychange",$.proxy(this._validateContact,this)),this.contactInput2.bind("focus input propertychange",$.proxy(this._validateContact,this))),this.battleTagInput1.bind("focus input",$.proxy(this._togglebattleTagNote,this)),this.passwordInput1.bind("focus input",$.proxy(this._validatePassword,this)),this.passwordInput2.bind("focus input",$.proxy(this._validatePassword,this)),this.secretQuestion.bind("focus",$.proxy(this._toggleSecretNote,this)),this.secretAnswer.bind("focus",$.proxy(this._toggleSecretNote,this))},block:function(){this.countryBlock.height(this.countryBlockable.height()).show(),this.countryBlockable.find("input").attr("disabled","disabled").removeClass("glow-shadow-2"),this.countryBlockable.find("select").attr("disabled","disabled").removeClass("glow-shadow-2"),this.countryBlockable.find("span.input-text").addClass("input-text-disabled"),this.countryBlockable.find("span.input-select").addClass("input-select-disabled"),this.countryBlockable.find("a.input-checkbox").addClass("input-checkbox-disabled"),this.countryBlockable.find("a.input-checkbox-checked").addClass("input-checkbox-checked-disabled"),this.countrySelect.addClass("input-select-disabled").removeClass("glow-shadow-2").attr("disabled","disabled")},unblock:function(){this.countryBlock.hide(),this.countryBlockable.find("input").removeAttr("disabled").addClass("glow-shadow-2"),this.countryBlockable.find("select").removeAttr("disabled").addClass("glow-shadow-2"),this.countryBlockable.find("span.input-text").removeClass("input-text-disabled"),this.countryBlockable.find("span.input-select").removeClass("input-select-disabled"),this.countryBlockable.find("a.input-checkbox").removeClass("input-checkbox-disabled"),this.countryBlockable.find("a.input-checkbox-checked").removeClass("input-checkbox-checked-disabled"),this.countrySelect.removeClass("input-select-disabled").addClass("glow-shadow-2").removeAttr("disabled")},resetCountry:function(){this.countrySelect.find('option[value="'+this.countryDefault+'"]')[0].selected=!0,this.keepCountry()},keepCountry:function(){this.unblock(),Core.browser==="ie6"||Core.browser==="ie7"?this.countryWarning.hide():this.countryWarning.slideUp(this.slideUpDuration)},changeCountry:function(e){this.countrySubmit[0].href="?country="+encodeURIComponent(e)+this.filterQueryString(),this.countryBlocked?window.location.href=this.countrySubmit[0].href:(this.block(),e==="CHINA"?(this.countryGlobal.hide(),this.countryCHINA.show()):(this.countryGlobal.show(),this.countryCHINA.hide()),Core.browser==="ie6"||Core.browser==="ie7"?(this.countryWarning.show(),this.countrySelect.hide().show()):(this.countryWarning.slideDown(this.slideDownDuration),this.countrySelect.hide().show(10)))},filterQueryString:function(e){e=e?"?":"&";var t=document.location.search,n=[],r=0,i="",s="",o="";t=t.substr(1),n=t.split("&");for(var u=0,a=n.length;u<a;u++){r=n[u].indexOf("="),i=encodeURIComponent(decodeURIComponent(n[u].substring(0,r))),s=encodeURIComponent(decodeURIComponent(n[u].substr(r+1)));if(i!=="style"&&i!=="ref"&&i!=="theme")continue;u===0?o=e+i+"="+s:o+="&"+i+"="+s}return o},_completeEmail:function(e){var t=this.config.domains,n=e.target.id,r=this.emailInput1[0].id;if(t.length){var i=new RegExp("^[0-9a-zA-Z+_.-]+@+$");if(i.test(e.target.value)){var s=e.target.value,o=[];for(var u=0,a;a=t[u];u++)o.push(s+a);this.autocompleteOptions.source=o,this.emailInput1.autocomplete(this.autocompleteOptions),this.emailInput2.autocomplete(this.autocompleteOptions),$.browser.msie&&$.browser.version.substr(0,1)<7&&n==r&&$("#question1").hide()}else this.autocompleteOptions.source=[]}n!==r&&this._validateEmail(e)},_validateEmail:function(e){var t=e.type,n=e.target.id,r=this.emailInput1[0].id,i=this.emailInput2[0].id,s=this.emailInput1[0].value.length,o=this.emailInput2[0].value.length,u=t==="keyup"||t==="input"||t==="propertychange"?100:0,a=this;n===r&&t==="focus"?(clearTimeout(this.emailTimer),this.emailTimer=null,this.emailMessage1.html(FormMsg.emailInfo)):n===i&&s>o?this.emailMessage2.html(" "):this.emailTimer===null&&(this.emailTimer=setTimeout(function(){a.validateEmail()},u))},validateEmail:function(){var e=!0,t=this.emailInput1[0].value,n=this.emailInput2[0].value,r=this.emailRight,i=this.emailLeft,s=this.emailInput1.attr("placeholder"),o=this.emailInput2.attr("placeholder"),u=this.emailValidator,a;return t===s&&(t=""),n===o&&(n=""),a=u.check(t,n),a[0]===-1?(this.emailMessage1.html(FormMsg.emailError1),e=!1):this.emailMessage1.html(" "),n!==""&&a[1]===-1?(this.emailMessage2.html(FormMsg.emailError2),e=!1):this.emailMessage2.html(" "),this.emailTimer!==null&&(clearTimeout(this.emailTimer),this.emailTimer=null),e?(this.activeEmailInput>-1&&(r.removeClass("input-error"),i.removeClass("input-error")),this.activeEmailInput=1):(r.addClass("input-error"),i.addClass("input-error")),this.emailValidated=e,e},_validateContact:function(e){var t=e.type,n=e.target.id,r=this.contactInput1[0].id,i=t==="keyup"||t==="input"||t==="propertychange"?100:0,s=this;return this.showContactInfo=!0,this.activeContactInput=n===r?0:1,this.contactTimer===null?(this.contactTimer=setTimeout(function(){s.validateContact()},i),!0):!1},validateContact:function(){var e=!0,t=this.contactInput1[0].value,n=this.contactInput2[0].value,r=this.contactRight,i=this.contactLeft,s=this.contactInput1.attr("placeholder"),o=this.contactInput2.attr("placeholder"),u=this.emailValidator,a;t===s&&(t=""),n===o&&(n=""),a=u.check(t,n),a[0]===-1&&!this.showContactInfo?(this.contactMessage1.html(FormMsg.emailError1),e=!1):this.contactMessage1.html(" "),n!==""&&a[1]===-1&&!this.showContactInfo?(this.contactMessage2.html(FormMsg.emailError2),e=!1):this.contactMessage2.html(" ");if(this.showContactInfo){var f=this.contactInfo.find("div.input-note-arrow");this.contactInfo.slideDown(this.slideDownDuration),this.activeContactInput===1?f.animate({left:"468px"},250):f.animate({left:"146px"},250)}else{var l=this;setTimeout(function(){l.contactInfo.slideUp(this.slideUpDuration)},100)}return this.contactTimer!==null&&(clearTimeout(this.contactTimer),this.contactTimer=null),e?(this.activeContactInput>-1&&(r.removeClass("input-error"),i.removeClass("input-error")),this.activeContactInput=1):(r.addClass("input-error"),i.addClass("input-error")),this.contactValidated=e,e},_validatePassword:function(e){var t=e.type,n=e.target.id,r=this.passwordInput1[0].id,i=t==="keyup"||t==="input"||t==="propertychange"?100:0,s=this;return this.showPasswordGuidelines=!0,this.activePasswordInput=n===r?0:1,this.passwordTimer===null?(this.passwordTimer=setTimeout(function(){s.checkPassword()},i),!0):!1},checkPassword:function(){var e=this.form,t=this.passwordValidator,n=!0,r=this.passwordInput1[0].type==="password"?this.passwordInput1[0].value:"",i=this.passwordInput2[0].type==="password"?this.passwordInput2[0].value:"",s=this.passwordRight,o=this.passwordLeft,u=this.passwordMessage1,a=this.passwordMessage2,f=this.passwordMessage1Default,l=this.passwordMessage2Default,c=this.emailInput1[0].value,h=this.showPasswordGuidelines;if(r.length>0){s.removeClass("input-error"),o.removeClass("input-error");for(var p=0,d,v;v=t.check(r,i,c)[p];p++)d=e.find("#password-level-"+p),d.removeClass(),v===1?d.addClass("pass"):v===-1&&(s.addClass("input-error"),o.addClass("input-error"),d.addClass("fail"),n=!1),p===4&&v===-1&&(h?a.html(" "):a.html(FormMsg.passwordError2));n||h?u.html(" "):(!n||a.html()===l||a.html()===" ")&&u.html(r===i?FormMsg.passwordError1:FormMsg.passwordError2)}else u.html(f),a.html(l),this.passwordLevels[0].removeClass(),this.passwordLevels[1].removeClass(),this.passwordLevels[2].removeClass(),this.passwordLevels[3].removeClass(),this.passwordLevels[4].removeClass(),n=!1;return this.ratePassword(),this.passwordValidated=n,n},ratePassword:function(){var e=this.passwordValidator,t=0,n=this.passwordInput1[0].type==="password"?this.passwordInput1[0].value:"",r=this.passwordRating,i=this.passwordResult,s=this.passwordMessage1,o=this.passwordMessage2;r.removeClass().addClass("rating rating-default"),i.html("").removeClass(),n.length>0&&(t=e.rate(n),t===4?(r.removeClass().addClass("rating rating-strong"),i.html(FormMsg.passwordStrength3)):t===3?(r.removeClass().addClass("rating rating-fair"),i.html(FormMsg.passwordStrength2)):t===2?(r.removeClass().addClass("rating rating-weak"),i.html(FormMsg.passwordStrength1)):t===1&&(r.removeClass().addClass("rating rating-short"),i.html(FormMsg.passwordStrength0).addClass("fail")));if(this.showPasswordGuidelines){s.html(" "),o.html(" ");var u=this.passwordGuidelines.find("div.input-note-arrow");this.passwordGuidelines.slideDown(this.slideDownDuration),this.activePasswordInput===1?u.animate({left:"468px"},250):u.animate({left:"146px"},250)}else this.passwordGuidelines.slideUp(this.slideUpDuration);this.passwordTimer!==null&&(clearTimeout(this.passwordTimer),this.passwordTimer=null)},_togglebattleTagNote:function(e){var t=e.type,n=e.target.id,r=this;return this.showbattleTagGuidelines=!0,this.battleTagTimer===null?(this.battleTagTimer=setTimeout(function(){r.togglebattleTagNote()},0),!0):!1},togglebattleTagNote:function(){this.showbattleTagGuidelines?this.battleTagGuidelines.show():this.battleTagGuidelines.hide(),this.battleTagTimer!==null&&(clearTimeout(this.battleTagTimer),this.battleTagTimer=null)},_toggleSecretNote:function(e){var t=e.type,n=e.target.id,r=this;return this.showSecretInfo=!0,this.secretTimer===null?(this.secretTimer=setTimeout(function(){r.toggleSecretNote()},0),!0):!1},toggleSecretNote:function(){this.showSecretInfo?this.secretInfo.show():this.secretInfo.hide(),this.secretTimer!==null&&(clearTimeout(this.secretTimer),this.secretTimer=null)},toggleWarnings:function(e){var t=e.id,n=this;for(var r=0,i=this.warningLines.length;r<i;r++){var s=$(this.warningLines[r]),o=s.attr("id").replace(/-message/,"");o!=t&&!s.hasClass("no-text-clear")&&!s.children(".inline-error").length?s.html(" "):(o=="question1"||o=="answer1")&&$("#question-info").css("display",t=="question1"||t=="answer1"?"block":"none")}t=="password"||t=="rePassword"?(this.passwordGuidelines.slideDown(this.slideDownDuration),this.config.showContactInfo&&this.contactInfo.slideUp(this.slideUpDuration)):t=="parentContactEmail"||t=="parentContactEmailConfirmation"?(this.passwordGuidelines.slideUp(this.slideUpDuration),this.config.showContactInfo&&this.contactInfo.slideDown(this.slideDownDuration)):t!="creation-submit"&&e.tagName!="a"&&(setTimeout(function(){n.passwordGuidelines.slideUp(n.slideUpDuration)},100),this.config.showContactInfo&&this.contactInfo.slideUp(this.slideUpDuration))},toggleErrorFlag:function(e,t){e=$(e),t?(e.parents("span.input-right").addClass("input-error"),e.parents("span.input-right").siblings("span.input-left").addClass("input-error")):(e.parents("span.input-right").removeClass("input-error"),e.parents("span.input-right").siblings("span.input-left").removeClass("input-error"))},enable:function(){this.form[0].onsubmit=new Function("return true")},disable:function(e){this.form[0].onsubmit=new Function("return false;")},makeErrorBox:function(e){$("#content .alert").remove();var t=e.length,n='<div class="alert error closeable border-4 glow-shadow"><div class="alert-inner"><div class="alert-message"><p class="title"><strong><a name="form-errors"> </a>'+FormMsg[t>1?"headerMultiple":"headerSingular"]+"</strong></p>";if(t>1){n+="<ul>";for(var r=0;r<t;r++)n+="<li>"+e[r]+"</li>";n+="</ul>"}else n+="<p>"+e[0]+"</p>";return n+="</div></div></div>",n}}),Confirmation=Class.extend({form:null,submitButton:null,emailInput1:null,contactInput1:null,contactMessage1:null,contactValidator:new Email,contactTimer:null,config:{},init:function(e,t){t=typeof t!="undefined"?t:{},e=$(e),e.length&&(e[0].tagName.toLowerCase()!=="form"&&(e=e.find("form")),this.form=e.length?e:null),e!==null&&(this.config=$.extend({contactFields:["#parentEmail"],emailFields:["#emailAddress"]},t),this.setup())},setup:function(){var e=this.form;this.submitButton=e.find("button[type=submit]"),this.emailInput1=$(this.config.emailFields[0]),this.contactInput1=$(this.config.contactFields[0]),this.contactMessage1=$(this.config.contactFields[0]+"-message"),this.form.bind("submit",{form:this},function(e){var t=!1;return UI.enableButton(e.data.form.submitButton),$("#parentEmail").val()&&e.data.form.contactValidated&&(t=!0),t}),this.contactInput1.bind("focus",$.proxy(this._validateContact,this)).bind("input propertychange",$.proxy(this._validateContact,this))},_validateContact:function(e){var t=e.type,n=t==="keyup"||t==="input"||t==="propertychange"?100:0,r=this;return this.contactTimer===null&&(this.emailTimer=setTimeout(function(){r.validateContact()},n)),!1},validateContact:function(){var e=!0,t=this.emailInput1[0].value,n=this.contactInput1[0].value,r=this.contactInput1.attr("placeholder"),i=this.contactValidator,s;return n===r&&(n=""),s=i.check(n),s[0]===-1?(this.contactMessage1.html(FormMsg.contactError1),e=!1):n===t?(this.contactMessage1.html(FormMsg.contactMessage1),e=!1):this.contactMessage1.html(" "),this.contactTimer!==null&&(clearTimeout(this.contactTimer),this.contactTimer=null),this.contactValidated=e,e},enable:function(){this.submitButton.removeClass("disabled").removeAttr("disabled")},disable:function(){this.submitButton.addClass("disabled").attr("disabled","disabled")}})