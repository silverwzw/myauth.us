/**
 * Creates skinnable form elements from HTML5 form elements.
 *
 * @copyright   2011, Blizzard Entertainment, Inc
 * @class       Inputs
 * @requires    Core
 */var Inputs=Class.extend({form:null,submitButton:null,requiredInputs:[],validationTimer:null,textInputs:[],textareaInputs:[],passwordInputs:[],checkboxInputs:[],checkboxLabels:[],checkboxAnchors:[],radioInputs:[],radioLabels:[],radioAnchors:[],radioSiblings:[],config:{},init:function(e,t){t=typeof t!="undefined"?t:{},e=$(e),e.length&&(e[0].tagName.toLowerCase()!=="form"&&(e=e.find("form")),this.form=e.length?e:null),this.form&&this.form[0].tagName.toLowerCase()==="form"&&(this.config=$.extend({checkbox:!0,radio:!0,placeholder:!0,novalidate:!0,required:!0},t),this.setup(),this.validate())},setup:function(){var e=this.config;this.submitButton=this.form.find("button[type=submit]"),e.checkbox&&this.form[0].tagName==="form"&&(this.checkboxInputs=this.form.find("input:checkbox"),this.checkboxInputs.length&&this.setupCheckboxes()),e.radio&&this.form[0].tagName.toLowerCase()==="form"&&(this.radioInputs=this.form.find("input:radio"),this.radioInputs.length&&this.form[0].tagName==="form"&&this.setupRadios()),this.form[0].tagName.toLowerCase()==="form"&&(this.textInputs=this.form.find('input[type="text"], input[type="email"], input[type="tel"]'),this.textareaInputs=this.form.find("textarea"),this.passwordInputs=this.form.find('input[type="password"]'),this.requiredInputs=this.form.find("input[required], select[required], textarea[required]"),this.textInputs.length&&e.placeholder&&!this.supportsPlaceholder()&&this.addPlaceholder(this.textInputs),this.textareaInputs.length&&e.placeholder&&!this.supportsPlaceholder()&&this.addPlaceholder(this.textareaInputs),this.passwordInputs.length&&e.placeholder&&!this.supportsPlaceholder()&&(this.isReadOnly()?this.addPlaceholderMessage(this.passwordInputs):this.addPlaceholder(this.passwordInputs,!0)),e.novalidate&&this.form.attr("novalidate","novalidate"),e.required&&this.addRequired(this.requiredInputs))},addRequired:function(e){for(var t=0,n,r,i;n=e[t];t++)r=$(n)[0].tagName.toLowerCase(),i="",r==="select"?$(n).bind("change",$.proxy(this._checkRequired,this)):r==="textarea"?$(n).bind("focus blur input propertychange",$.proxy(this._checkRequired,this)):r==="input"&&(i=$(n)[0].type,i==="checkbox"||i==="radio"?$(n).bind("change",$.proxy(this._checkRequired,this)):$(n).bind("focus blur input propertychange",$.proxy(this._checkRequired,this)))},_checkRequired:function(e){var t=e.type,n=t==="keyup"||t==="input"||t==="propertychange"?100:0,r=this;return this.validationTimer===null?(this.validationTimer=setTimeout(function(){r.validate()},n),!0):!1},validate:function(){var e=this.form,t=!0,n=this.requiredInputs,r=this.radioInputs;for(var i=0,s,o,u,a,f,l;s=n[i];i++){o=$(s)[0].tagName.toLowerCase(),u="",a="",f="",l="";if(o==="select")a=$(s).find("option:selected").val();else if(o==="textarea")a=$(s).val(),l=$(s).attr("placeholder");else if(o==="input"){u=$(s)[0].type;if(u==="checkbox")$(s)[0].checked?a="checked":a="";else if(u==="radio")if($(s)[0].checked)a="checked";else{f=$(s)[0].name,a="";for(var c=0,h;h=r[c];c++)if(h.name===f&&h.checked){a="checked";break}}else a=$(s).val(),l=$(s).attr("placeholder")}if(a===""||a===l)t=!1}return this.validationTimer!==null&&(clearTimeout(this.validationTimer),this.validationTimer=null),setTimeout(function(){e.trigger("validate",[t])},0),t},addPlaceholder:function(e,t){t=typeof t=="undefined"?!1:t;for(var n=0,r;r=e[n];n++){var i;r=$(r),i=r.attr("placeholder");if(typeof i=="undefined")continue;if(r.val()===""||t)r.val(i),r.addClass("placeholder"),t&&r.attr("type","text");t?r.bind("focus blur",$.proxy(this._togglePassword,this)):r.bind("focus blur",$.proxy(this._toggleText,this))}},addPlaceholderMessage:function(e){for(var t=0,n;n=e[t];t++){var r,i;n=$(n),r=n.attr("placeholder"),i=$("#"+n[0].id+"-message");if(typeof r=="undefined")continue;(n.val()===""||isPassword)&&i.text(r),n.bind("focus blur",$.proxy(this._toggleMessage,this))}},_toggleText:function(e){var t=e.type,n=e.target.value,r=$(e.target).attr("placeholder");t==="blur"&&n.length===0?(e.target.value=r,$(e.target).addClass("placeholder")):t==="focus"&&(n===r&&(e.target.value=""),$(e.target).removeClass("placeholder"))},_togglePassword:function(e){var t=e.type,n=e.target.value,r=$(e.target).attr("placeholder");t==="blur"&&n.length===0?(e.target.value=r,e.target.type="text",$(e.target).addClass("placeholder")):t==="focus"&&(n===r&&(e.target.value="",e.target.type="password"),$(e.target).removeClass("placeholder"))},_toggleMessage:function(e){var t=e.type,n=e.target.value,r=$(e.target).attr("placeholder"),i=$("#"+e.target.id+"-message");t==="blur"&&n.length===0?i.text(r):t==="focus"&&n===r&&i.text("")},setupCheckboxes:function(){for(var e=0,t;t=this.checkboxInputs[e];e++){var n=t.checked,r,i,s,o="input-checkbox",u,a,f,l;t=$(t),r=t.attr("id"),i="#"+r,s=t.attr("name"),o=n?o+" input-checkbox-checked":o,u=t.attr("tabindex"),a=typeof t.attr("disabled")!="undefined",n?o=a?o+" input-checkbox-checked-disabled":o:o=a?o+" input-checkbox-disabled":o,t.before('<a id="'+r+'-link" href="'+i+'" rel="'+s+'" class="'+o+'" tabindex="'+u+'"></a>'),t.removeAttr("tabindex"),t.wrap('<span class="input-hidden" />'),this.checkboxLabels[e]=this.form.find('label[for="'+r+'"]'),f=this.checkboxLabels[e],this.checkboxAnchors[e]=f.find('a[href="'+i+'"]'),l=this.checkboxAnchors[e],a?f.unbind().bind("mouseenter",function(){$(this).css("cursor","default")}).bind("click",function(){return!1}):f.unbind().bind("mouseenter",{checkbox:t[0],a:l},function(e){e.data.checkbox.checked?e.data.a.addClass("input-checkbox-checked-hover"):e.data.a.addClass("input-checkbox-hover")}).bind("mouseleave",{checkbox:t[0],a:l},function(e){e.data.checkbox.checked?e.data.a.removeClass("input-checkbox-checked-hover"):e.data.a.removeClass("input-checkbox-hover")}).bind("click",{checkbox:t,checked:n,a:l},function(e){return e.data.checkbox[0].checked=e.data.checkbox[0].checked?!1:!0,e.data.checkbox[0].checked?e.data.a.addClass("input-checkbox-checked"):e.data.a.removeClass("input-checkbox-checked"),e.data.a.removeClass("input-checkbox-checked-hover"),e.data.a.removeClass("input-checkbox-hover"),e.data.checkbox.trigger("change"),e.target.tagName==="a"&&!$(e.target).hasClass("input-checkbox")}).bind("keyup",{checkbox:t,checked:n,a:l},function(e){if(e.keyCode===32)return e.data.checkbox[0].checked=e.data.checkbox[0].checked?!1:!0,e.data.checkbox[0].checked?e.data.a.addClass("input-checkbox-checked"):e.data.a.removeClass("input-checkbox-checked"),e.data.a.removeClass("input-checkbox-checked-hover"),e.data.a.removeClass("input-checkbox-hover"),e.data.checkbox.trigger("change"),e.target.tagName==="a"&&!$(e.target).hasClass("input-checkbox")}).bind("keydown",function(e){if(e.keyCode===32)return!1})}},_toggleCheckbox:function(e){var t=e.type,n=e.target.value,r=$(e.target).attr("placeholder");t==="blur"&&n.length===0?(e.target.value=r,$(e.target).addClass("placeholder")):t==="focus"&&(n===r&&(e.target.value=""),$(e.target).removeClass("placeholder"))},setupRadios:function(){var e=0,t,n,r,i,s,o,u,a,f,l;for(e=0;t=this.radioInputs[e];e++)n=t.checked,o="input-radio",t=$(t),r=t.attr("id"),i="#"+r.replace("[","").replace("]",""),s=t.attr("name"),o=n?o+" input-radio-checked":o,u=t.attr("tabindex"),a=typeof t.attr("disabled")!="undefined",n?o=a?o+" input-radio-checked-disabled":o:o=a?o+" input-radio-disabled":o,t.before('<a href="'+i+'" rel="'+s+'" class="'+o+'" tabindex="'+u+'"></a>'),t.removeAttr("tabindex"),t.wrap('<span class="input-hidden" />');for(e=0;t=this.radioInputs[e];e++){var c;n=t.checked,t=$(t),r=t.attr("id"),i="#"+r.replace("[","").replace("]",""),s=t.attr("name"),o=n?o+" input-radio-checked":o,u=t.attr("tabindex"),a=typeof t.attr("disabled")!="undefined",this.radioLabels[e]=this.form.find('label[for="'+r+'"]'),f=this.radioLabels[e],this.radioAnchors[e]=f.find('a[href="'+i+'"]'),l=this.radioAnchors[e],this.radioSiblings[e]=this.form.find('a[rel="'+s+'"]'),c=this.radioSiblings[e],a?f.unbind().bind("mouseenter",function(){$(this).css("cursor","default")}).bind("click",function(){return!1}):f.unbind().bind("mouseenter",{radio:t[0],a:l},function(e){e.data.radio.checked?e.data.a.addClass("input-radio-checked-hover"):e.data.a.addClass("input-radio-hover")}).bind("mouseleave",{radio:t[0],a:l},function(e){e.data.radio.checked?e.data.a.removeClass("input-radio-checked-hover"):e.data.a.removeClass("input-radio-hover")}).bind("click",{radio:t,checked:n,a:l,s:c},function(e){return e.data.s.removeClass("input-radio-checked"),e.data.radio[0].checked=!0,e.data.radio[0].checked&&e.data.a.addClass("input-radio-checked"),e.data.a.removeClass("input-radio-checked-hover"),e.data.a.removeClass("input-radio-hover"),e.data.radio.trigger("change"),e.target.tagName==="a"&&!$(e.target).hasClass("input-radio")}).bind("keyup",{radio:t,checked:n,a:l,s:c},function(e){if(e.keyCode===32)return e.data.s.removeClass("input-radio-checked"),e.data.radio[0].checked=!0,e.data.radio[0].checked&&e.data.a.addClass("input-radio-checked"),e.data.a.removeClass("input-radio-checked-hover"),e.data.a.removeClass("input-radio-hover"),e.data.radio.trigger("change"),e.target.tagName==="a"&&!$(e.target).hasClass("input-radio")}).bind("keydown",function(e){if(e.keyCode===32)return!1})}},isReadOnly:function(){return $.browser.msie},supportsPlaceholder:function(){var e=document.createElement("input");return"placeholder"in e}})