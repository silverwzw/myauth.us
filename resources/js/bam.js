function openAccountDropdown(e,t){var n=$("#"+t+"-menu");if(n.is(":visible")){n.hide();return}$(".flyout-menu").hide(),Toggle.open(e,"","#"+t+"-menu")}function openFloatingAccountDropdown(e,t,n,r){var i=$("#"+t+"-menu"),s=$(e).position();if(i.is(":visible")){i.hide();return}i.css({top:parseInt(s.top)+r+"px",left:parseInt(s.left)+n+"px"}),$(".flyout-menu").hide(),Toggle.open(e,"","#"+t+"-menu")}function openEbankOptions(e){var t=$("#balance-options");if(t.is(":visible")){t.hide();return}$("#balance-options").hide(),Toggle.open(e,"","#balance-options")}function ComboBox(e,t,n){function a(){var n=0,i=o.length,u="";if(i===1){u='<option value="'+o[0][0]+'" selected="selected">'+o[0][1]+"</option>",t.empty(),t.html(u),r.selectOption();return}if(i>0){for(n;n<i;n++)u=u+'<option value="'+o[n][0]+'">'+o[n][1]+"</option>";r.showSelect()}else{i=s.length;for(n;n<i;n++)u=u+'<option value="'+s[n][0]+'">'+s[n][1]+"</option>";r.hideSelect()}t.empty(),t.html(u),Core.getBrowser()=="ie7"&&t.width(e.outerWidth())}function f(e){return e=e.toLowerCase(),e=e.replace("é","e"),e=e.replace("ü","u"),e=e.replace(" - "," – "),e=e.replace(" – "," "),e}var r=this,e=$(e),t=$(t),i=t.find("option"),n=$(n),s=[],o=[],u=null;r.initialize=function(){if(!t.length||!e.length)return!1;var o=0,a=i.length;for(o;o<a;o++){var l=$(i[o]);s.push([l.val(),l.text(),f(l.text())])}n.bind({click:function(){return r.filterOptions(""),r.showSelect(),!1}}),t.bind({keyup:function(e){if(e.which===13)return t.trigger("click"),!1},click:function(){return r.selectOption(),!1}}),e.attr("autocomplete","off"),e.bind({keyup:function(e){clearTimeout(u),u=null,e.which===40?(t.selectedIndex=0,t.find("option")[0].selected=!0,t.focus()):u=setTimeout(function(){r.filterOptions(e.target.value)},250)},focus:function(e){e.target.select()}})},r.hideSelect=function(){t.hide(),n.show()},r.showSelect=function(){t.show(),n.hide()},r.filterOptions=function(e){var t=0,n=i.length,r="",u="";o=[];for(t;t<n;t++)u=s[t][2],r=f(e),u.lastIndexOf(r)>=0&&o.push(s[t]);a()},r.selectOption=function(){t.hide(),n.show(),e.val($("#"+t.attr("id")+" option:selected").text())},this.initialize()}function showErrors(e,t){var n=t.length,r=$(".templates > .error").clone(),i=r.find(".error-title"),s=r.find(".error-message"),o=r.find(".error-messages");if(r.length){i.html(e);if(n>1){s.remove();var u;for(var a=0;a<n;a++)u=document.createElement("li"),u.appendChild(document.createTextNode(t[a])),o.append(u)}else o.remove(),s.append(t[0]);$("#content > .alert").remove(),$("#content").prepend(r),window.location.href=window.location.pathname+window.location.search+"#form-errors"}}function trackPageviewAnalytics(e){typeof _gaq!="undefined"&&_gaq.push(["_trackPageview",window.location.pathname+"["+e+"-TRACKING]"+window.location.search+window.location.hash])}$(document).ready(function(){UI.initialize()});var supportToken="";(function(e){var t=e.unique;e.unique=function(n){return n[0]&&!!n[0].nodeType?t.apply(this,arguments):e.grep(n,function(t,r){return e.inArray(t,n)===r})}})(jQuery);var UI={buttons:{},notes:{},compactInputs:{},inlineInputs:{},parent:$("#content"),initialize:function(e){UI.parent=e||$("#content"),UI.buttons=$(".ui-button",UI.parent),UI.notes=$(".ui-note",UI.parent),UI.compactInputs=$(".label-compact",UI.parent).parent().children("input.input"),UI.inlineInputs=$("input.inline-input"),UI.buttons.length>0&&UI._initializeButtons(),UI.notes.length>0&&UI._initializeNotes(),UI.compactInputs.length>0&&UI._initializeCompactInputs(),UI.inlineInputs.length>0&&UI._initializeInlineInputs()},_initializeInlineInputs:function(){var e=UI.inlineInputs.length,t=0;for(t;t<e;t++){var n=UI.inlineInputs[t];$(n).bind({keypress:function(e){var t=this.value;if(e.keyCode==8&&t.length===0){var n=$(this).prev("input.inline-input");$(n).focus()}},keydown:function(e){if(!jQuery.support.cssFloat){var t=this.value;if(e.keyCode==8&&t.length===0){var n=$(this).prev("input.inline-input");$(n).focus()}}},focus:function(){this.value=this.value},keyup:function(e){var t=[8,9,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,46,144,145],n=t.toString(),r=parseInt($(this).attr("maxlength"),10),i=this.value;n.indexOf(e.keyCode)==-1&&i.length===r&&$(this).next("input.inline-input").focus()}})}},_initializeCompactInputs:function(){var e=UI.compactInputs.length,t=e-1;if(t>0)do{var n=UI.compactInputs[t],r=$.trim($(n).parent().find(".label-compact strong").text());$(n).val(r).bind({focus:function(){$(this).val()===r&&$(this).val("")},blur:function(){$(this).val()===""&&$(this).val(r)}})}while(t--)},_initializeNotes:function(){UI.notes.children(".note-toggler").bind({click:function(){return UI.showNotes(this),!1}}),UI.notes.children(".toggle-note").bind({click:function(){return!1}}),UI.notes.children(".toggle-note").children(".note").children(".close-note").bind({click:function(){return UI.hideNotes(this),!1}}),$(document).bind({click:function(){UI.hideNotes()}})},hideNotes:function(e){if(e===undefined)$(".toggle-note").hide(),$(".note-toggler").show();else{var t=$(e).attr("rel");$(e).parent().parent(".toggle-note").hide(),$('.note-toggler[rel="'+t+'"]').show()}},showNotes:function(e){if(e===undefined)$(".toggle-note").show(),$(".note-toggler").hide();else{var t=$(e).attr("rel");$(e).hide(),$("#"+t).show()}},_initializeButtons:function(){UI.buttons.bind({click:function(e){var t=$(this),n=t.attr("onclick"),r=t.parents("form");this.tagName.toLowerCase()==="button"&&(n===""||n===undefined||n===null)&&r.length>0&&(e.preventDefault(),e.stopPropagation(),r.submit())},mouseover:function(){$(this).addClass("hover")},mouseout:function(){$(this).removeClass("hover")}})},freezeButton:function(e){$(e).addClass("disabled"),$(e)[0].tagName.toLowerCase()==="button"&&$(e).attr("disabled","disabled")},wakeButton:function(e){$(e).removeClass("disabled"),$(e)[0].tagName.toLowerCase()==="button"&&$(e).removeAttr("disabled")},processButton:function(e){$(e).addClass("processing"),$(e)[0].tagName.toLowerCase()==="button"&&$(e).attr("disabled","disabled")},disableButton:function(e){$(e).addClass("disabled"),$(e)[0].tagName.toLowerCase()==="button"&&$(e).attr("disabled","disabled")},enableButton:function(e){$(e).removeClass("disabled").removeClass("processing"),$(e)[0].tagName.toLowerCase()==="button"&&$(e).removeAttr("disabled")}},ChargebackCall={target:$("#chargebackCount"),chargebackCount:0,chargebackCookie:"bam-chargebackCount",refresh:null,initialize:function(e){var t=Cookie.read(ChargebackCall.chargebackCookie),n="",r=!1,i,s;e&&(this.refresh=e);if(e||!t){if(typeof chargebackRegionNumbers!="undefined"){chargebackRegionNumbers=$.unique(chargebackRegionNumbers);for(var i=0,s=chargebackRegionNumbers.length;i<s;i++){switch(chargebackRegionNumbers[i]){case 2:n="EU",r=!0}n=="NA"&&(n="US"),r&&n!==""&&(ChargebackCall.getChargeback(chargebackRegionNumbers[i],n),r=!1)}}}else ChargebackCall.chargebackCount=t,ChargebackCall.showChargeback(!1)},getChargeback:function(e,t){$.ajax({timeout:6e4,url:Core.baseUrl+"/data/wow-licenses-details.html?region="+t+"&_="+(new Date).getTime(),success:function(e){ChargebackCall.chargebackCount=0;for(var t=0;t<e.length;t++)e[t]!==""&&e[t].status!=="ERROR"&&(ChargebackCall.chargebackCount=parseInt(ChargebackCall.chargebackCount,10)+parseInt(e[t].chargebackCount,10));ChargebackCall.showChargeback(!0)}})},showChargeback:function(e){ChargebackCall.chargebackCount>0&&this.target.text(ChargebackCall.chargebackCount).addClass("display-bug"),ChargebackCall.setCookie(ChargebackCall.chargebackCount)},setCookie:function(e){Cookie.create(ChargebackCall.chargebackCookie,e,{expires:1})}},DateTime=Class.extend({times:null,format:"",locale:Core.locale,init:function(e){e=typeof e=="undefined",this.times=$("time");switch(this.locale){default:case"cs-cz":case"de-de":case"pl-pl":this.format="dd.MM.yyyy",e&&(this.format=this.format+" HH:mm");break;case"en-us":this.format="MM/dd/yyyy",e&&(this.format=this.format+" hh:mm a");break;case"en-gb":case"es-es":case"es-mx":case"fr-fr":case"pt-br":case"it-it":case"ru-ru":this.format="dd/MM/yyyy",e&&(this.format=this.format+" HH:mm");break;case"en-sg":this.format="dd/MM/yyyy",e&&(this.format=this.format+" hh:mm a");break;case"ja-ja":this.format="yyyy/MM/dd",e&&(this.format=this.format+" HH:mm");break;case"ko-kr":this.format="yyyy.MM.dd",e&&(this.format=this.format+" HH시mm분");break;case"zh-cn":this.format="yyyy年MM月dd日",e&&(this.format=this.format+" HH:mm");break;case"zh-tw":this.format="yyyy-MM-dd",e&&(this.format=this.format+" HH:mm")}this.times.length&&this.localize()},localize:function(){var e=this.times,t=this.format,n=this.locale,r=null;for(var i=0,s=e.length;i<s;i++){time=$(e[i]),r=time.attr("datetime"),r=Core.formatDatetime(t,r);if(!r)return;r=r.replace("/0","/"),r.substr(0,1)==="0"&&(r=r.substr(1));if(n==="en-us"||n==="en-sg")r=r.replace(" 0"," ");$.browser.msie?time.parent().html(r):time.html(r)}}}),accountBalance={accountBalanceCurrency:null,accountBalanceCenter:$("#accountBalanceCenter"),accountBalanceMenu:$("#accountBalance-menu"),changeCurrencyMenu:$("#changeCurrency-menu"),accountBalancePrimaryBalance:$("#primary-balance"),refreshBalanceElement:$("#refreshBalance"),refreshingBalanceElement:$("#refreshingBalance"),currencyMap:{},initialize:function(){accountBalance.accountBalanceCurrency&&accountBalance.setPrimary(accountBalance.accountBalanceCurrency),accountBalance.bindCurrencies()},bindCurrencies:function(){this.accountBalanceMenu.find(".switch-currency").each(function(){$(this).bind({click:function(){var e=$(this).hasClass("selected");e||(accountBalance.accountBalanceCurrency=$(this).attr("id"),accountBalance.setAccountBalanceCurrency())}})}),this.changeCurrencyMenu.find(".switch-currency").each(function(){$(this).bind({click:function(){accountBalance.accountBalanceCurrency=$(this).attr("id"),accountBalance.setAccountBalanceCurrency()}})})},selectCurrency:function(e){var t=$("#"+e).hasClass("selected");t||(accountBalance.accountBalanceCurrency=e,accountBalance.setAccountBalanceCurrency())},refreshBalance:function(){(Core.browser=="ie6"||Core.browser=="ie7"||Core.browser=="ie8"||Core.browser=="ie9")&&window.location.reload(),this.refreshBalanceElement.hide(),this.refreshingBalanceElement.show(),$.ajax({timeout:6e4,url:Core.baseUrl+"/data/refresh-balance.html",success:function(e){if(e!==""){var t=e,n=accountBalance.accountBalanceCurrency,r="";$("#accountBalance-menu ul li.switch-currency").remove();for(var i in t)if(t[i].balance>0){var s=accountBalance.getBalanceFormatting(t[i].balance,t[i].currency),o="switch-currency";n==t[i]["currency"]&&(o+=" selected",$("#primary-balance").text(s));var u=" onclick='accountBalance.selectCurrency(&quot;"+t[i].currency+"&quot;);' ";r+="<li id='"+t[i].currency+"' class='"+o+"'"+u+"><span>"+s+"</span></li>"}$("#accountBalance-menu ul").children(":first").before(r)}},error:function(){}}),accountBalance.bindCurrencies(),setTimeout("accountBalance.toggleRefresh()",1e3)},toggleRefresh:function(){this.refreshBalanceElement.show(),this.refreshingBalanceElement.hide()},setPrimary:function(e){if(accountBalance.changeCurrencyMenuFlag)return window.location.reload(),!1;accountBalance.accountBalanceCurrency=e,this.accountBalanceMenu.find(".switch-currency").removeClass("selected");var t=this.accountBalanceCenter.find("#"+e).addClass("selected"),n=t.find("span").html();n!==null?this.accountBalancePrimaryBalance.html(n):(price=0,this.accountBalancePrimaryBalance.html(accountBalance.getBalanceFormatting(price)))},setAccountBalanceCurrency:function(e){e&&(accountBalance.accountBalanceCurrency=e),$.ajax({timeout:6e4,url:Core.baseUrl+"/management/set-account-cookie.html?prefix=CUR&value="+accountBalance.accountBalanceCurrency+"&_="+(new Date).getTime(),success:function(t){t!==""&&t.successful!==""&&t.successful===!0&&t.value!==undefined&&(accountBalance.setPrimary(t.value),e&&(location.href="transaction-history.html?currency="+t.value))},error:function(){}})},getBalanceFormatting:function(e,t){return t=t||accountBalance.accountBalanceCurrency,e=accountBalance._getNumber(e,t),e=accountBalance._getNumberGroup(e,t),e=accountBalance._getCurrencyFormat(e,t),e},_getNumber:function(e,t){return e&&(typeof e!="number"&&(e=e.replace(",",".").replace(/[^0-9\.]/g,"")),e=parseFloat(parseFloat(e,10).toFixed(2),10)),e},_getNumberGroup:function(e,t){t=t||accountBalance.accountBalanceCurrency;if(t=="CPT"&&e==0)return e;var n,r,i,s,o,u=/(^[+-]?\d+)(\d{3})/;accountBalance.currencyMap[t]?(i=accountBalance.currencyMap[t].groupSize||3,s=accountBalance.currencyMap[t].delimiter||",",o=accountBalance.currencyMap[t].point||"."):(i=3,s=",",o="."),e+="",e=e.split(".");while(u.test(e[0]))e[0]=e[0].replace(u,"$1"+s+"$2");return e[1]?e[1].length>=2?e[1]=e[1].substring(0,2):e[1]+="0":e[1]="00",e[0]+o+e[1]},_getCurrencyFormat:function(e,t){return t=t||accountBalance.accountBalanceCurrency,accountBalance.currencyMap[t]&&(e=accountBalance.currencyMap[t].format.replace("{0}",e)),e},setError:function(){return!1}},Region={data:{us:1,eu:2,kr:3,tw:4,cn:5,sea:6},getRegion:function(e){return Region.getByString(e)||Region.getByNumber(e)},getByString:function(e){return typeof e=="string"?Region.data[e.toLowerCase()]:!1},getByNumber:function(e){for(var t in Region.data)if(Region.data.hasOwnProperty(t)&&Region.data[t]===e)return t;return!1}},InputValidator={initialize:function(e){var t,n=e.input.length,r;for(t=0;t<n;t++)$("#"+e.input[t].id).bind("keyup change",function(){r=InputValidator.validateMaxLength(),InputValidator.setResult(r)})},validateMaxLength:function(){var e,t=objInput.input.length,n,r,i;for(e=0;e<t;e++){n=$("#"+objInput.input[e].id).attr("maxlength"),r=$("#"+objInput.input[e].id).val().length;if(n!=r)return!1;i=!0}return i},setResult:function(e){e?UI.enableButton("#"+objInput.resultButton):UI.disableButton("#"+objInput.resultButton)}}